<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Reacoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Reacoder">
<meta property="og:url" content="http://reacoder.github.io/page/2/">
<meta property="og:site_name" content="Reacoder">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reacoder">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="Reacoder" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://tp2.sinaimg.cn/1918409225/180/40039469631/1">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">Reacoder</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/categories/Android/">Android</a></li>
				        
							<li><a href="/2014/12/01/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Reacoder" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/1918409225" title="weibo">weibo</a>
					        
								<a class="google" target="_blank" href="https://plus.google.com/u/0/117706805140071058584/posts" title="google">google</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud">
						<a href="/tags/Studio/" style="font-size: 10.00px;">Studio</a><a href="/tags/adb/" style="font-size: 10.00px;">adb</a><a href="/tags/animation/" style="font-size: 10.00px;">animation</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/canvas/" style="font-size: 10.00px;">canvas</a><a href="/tags/cmd/" style="font-size: 10.00px;">cmd</a><a href="/tags/customView/" style="font-size: 20.00px;">customView</a><a href="/tags/git/" style="font-size: 10.00px;">git</a><a href="/tags/gradle/" style="font-size: 10.00px;">gradle</a><a href="/tags/hexo/" style="font-size: 15.00px;">hexo</a><a href="/tags/image/" style="font-size: 10.00px;">image</a><a href="/tags/listview/" style="font-size: 15.00px;">listview</a><a href="/tags/menu/" style="font-size: 10.00px;">menu</a><a href="/tags/nodejs/" style="font-size: 10.00px;">nodejs</a><a href="/tags/note/" style="font-size: 10.00px;">note</a><a href="/tags/spannableString/" style="font-size: 10.00px;">spannableString</a><a href="/tags/textView/" style="font-size: 10.00px;">textView</a><a href="/tags/toolbar/" style="font-size: 10.00px;">toolbar</a><a href="/tags/touchEvent/" style="font-size: 15.00px;">touchEvent</a><a href="/tags/tutorial/" style="font-size: 10.00px;">tutorial</a><a href="/tags/video/" style="font-size: 10.00px;">video</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://tp2.sinaimg.cn/1918409225/180/40039469631/1">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">Reacoder</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/Android/">Android</a></li>
		        
					<li><a href="/2014/12/01/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Reacoder" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1918409225" title="weibo">weibo</a>
			        
						<a class="google" target="_blank" href="https://plus.google.com/u/0/117706805140071058584/posts" title="google">google</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      
  
    <article id="post-android-custom-viewgroup" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/29/android-custom-viewgroup/" class="article-date">
  	<time datetime="2014-11-29T13:06:23.000Z" itemprop="datePublished">Nov 29 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/29/android-custom-viewgroup/">android 自定义ViewGroup</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概论：">概论：</h3>
<ol>
<li>三种自定义的比较</li>
<li>继承自ViewGroup</li>
<li>onMeasure()</li>
<li>onLayout()</li>
<li>自定义LayoutParams</li>
<li>稍微说下draw吧</li>
<li>参考链接</li>
</ol>
<h3 id="1-三种自定义的比较">1.三种自定义的比较</h3>
<p><strong>Custom Views</strong></p>
<ul>
<li>Extending the View</li>
<li>Overriding onMeasure()</li>
<li>Overriding onDraw()</li>
<li>Saving state using the BaseSavedState pattern</li>
<li>Working with custom attributes</li>
<li>Understanding and applying requestLayout and invalidate</li>
</ul>
<p><em>In contrast, you can ignore the following details when creating custom views:</em></p>
<ul>
<li>Overriding onLayout()</li>
<li>Implementating and using LayoutParams</li>
</ul>
<hr>
<p><strong>Compound Controls</strong></p>
<ul>
<li>Extend an existing layout</li>
<li>Saving state using the BaseSavedState pattern </li>
<li>Taking control of saving state for its child views </li>
<li>Working with custom attributes</li>
</ul>
<p><em>While you can ignore:</em></p>
<ul>
<li>Overriding onMeasure()</li>
<li>Overriding onDraw()</li>
<li>Overriding onLayout()</li>
<li>Worrying about requestLayout() and invalidate() </li>
<li>Implementing and using LayoutParams</li>
</ul>
<hr>
<p><strong>Custom Layouts</strong></p>
<ol>
<li>Inherit from ViewGroup</li>
<li>Override onMeasure()</li>
<li>Override onLayout()</li>
<li>Implement custom LayoutParams with any additional layout attributes</li>
<li>Override layout parameters construction methods in the custom layout class</li>
</ol>
<h3 id="2-继承自ViewGroup">2.继承自ViewGroup</h3>
<p>流水线布局的样子：<br><img src="http://ww2.sinaimg.cn/mw690/72589a09gw1ems6lryrsij20cb09yaal.jpg" alt=""></p>
<p>这里的代码和自定义view差不多，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span></div><div class="line">{</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String tag=<span class="string">"FlowLayout"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> hspace=<span class="number">10</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> vspace=<span class="number">10</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context) {</div><div class="line">		<span class="keyword">super</span>(context);</div><div class="line">		initialize(context);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">		<span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">		TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">				R.styleable.FlowLayout, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">		hspace = t.getDimensionPixelSize(R.styleable.FlowLayout_hspace,</div><div class="line">				hspace);</div><div class="line">		vspace = t.getDimensionPixelSize(R.styleable.FlowLayout_vspace,</div><div class="line">				vspace);</div><div class="line">		Log.d(tag,<span class="string">"hspace:"</span> + hspace);</div><div class="line">		Log.d(tag,<span class="string">"vspace:"</span> + vspace);</div><div class="line">		t.recycle();</div><div class="line">		initialize(context);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context, AttributeSet attrs) {</div><div class="line">		<span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span>(Context context) {</div><div class="line">	}</div><div class="line">	...</div><div class="line">}</div></pre></td></tr></table></figure>

<p>就是自定义属性多了个布局属性，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"FlowLayout"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"hspace"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"vspace"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"FlowLayout_Layout"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"layout_space"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="3-onMeasure()">3.onMeasure()</h3>
<p>这里需要注意的地方比较多，也有点难理解。<br>由于是<code>ViewGroup</code>，你需要先measure children，但是比不能直接用<del><code>child.measure()</code></del>，因为这个方法完全没考虑ViewGroup的MeasureSpec，你应该用的是<code>ViewGroup.measureChild()</code>。到最后你<code>setMeasuredDimension()</code>，还需要用<code>resolveSize(w, widthMeasureSpec)</code>来计算ViewGroup的实际尺寸，因为你所有的children的尺寸有可能超出ViewGroup的尺寸，所以框架提供了这个方便的方法让我们使用。</p>
<p>看下这个图有助于了解接下来的代码：<br><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1ems7kdsk6qj20hc0emgmc.jpg" alt=""></p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//This is very basic</span></div><div class="line"><span class="comment">//doesn't take into account padding</span></div><div class="line"><span class="comment">//You can easily modify it to account for padding</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) </div><div class="line">{</div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="comment">//Initialize</span></div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="keyword">int</span> rw = MeasureSpec.getSize(widthMeasureSpec);</div><div class="line">	<span class="keyword">int</span> rh = MeasureSpec.getSize(heightMeasureSpec);</div><div class="line">	<span class="keyword">int</span> h = <span class="number">0</span>; <span class="comment">//current height</span></div><div class="line">	<span class="keyword">int</span> w = <span class="number">0</span>; <span class="comment">//current width</span></div><div class="line">	<span class="keyword">int</span> h1 = <span class="number">0</span>, w1=<span class="number">0</span>; <span class="comment">//Current point to hook the child to</span></div><div class="line">	</div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="comment">//Loop through children</span></div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="keyword">int</span> numOfChildren = <span class="keyword">this</span>.getChildCount();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; numOfChildren; i++ )</div><div class="line">	{</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Front of the loop</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">		<span class="keyword">this</span>.measureChild(child,widthMeasureSpec, heightMeasureSpec);</div><div class="line">		<span class="keyword">int</span> vw = child.getMeasuredWidth();</div><div class="line">		<span class="keyword">int</span> vh = child.getMeasuredHeight();</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (w1 + vw &gt; rw)</div><div class="line">		{</div><div class="line">			<span class="comment">//new line: max of current width and current width position</span></div><div class="line">			<span class="comment">//when multiple lines are in play w could be maxed out</span></div><div class="line">			<span class="comment">//or in uneven sizes is the max of the right side lines</span></div><div class="line">			<span class="comment">//all lines don't have to have the same width</span></div><div class="line">			<span class="comment">//some may be larger than others</span></div><div class="line">			w = Math.max(w,w1);</div><div class="line">			<span class="comment">//reposition the point on the next line</span></div><div class="line">			w1 = <span class="number">0</span>; <span class="comment">//start of the line</span></div><div class="line">			h1 = h1 + vh; <span class="comment">//add view height to the current heigh</span></div><div class="line">		}</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Middle of the loop</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="keyword">int</span> w2 = <span class="number">0</span>, h2 = <span class="number">0</span>; <span class="comment">//new point for the next view</span></div><div class="line">		w2 = w1 + vw;</div><div class="line">		h2 = h1;</div><div class="line">		<span class="comment">//latest height: current point + height of the view</span></div><div class="line">		<span class="comment">//however if the previous height is larger use that one</span></div><div class="line">		h = Math.max(h,h1 + vh);</div><div class="line">		</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Save the current coords for the view </span></div><div class="line">		<span class="comment">//in its layout</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line">		lp.x = w1;</div><div class="line">		lp.y = h1;</div><div class="line">	</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Restart the loop </span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		w1=w2;</div><div class="line">		h1=h2;</div><div class="line">	}</div><div class="line"><span class="comment">//********************</span></div><div class="line"><span class="comment">//End of for </span></div><div class="line"><span class="comment">//********************</span></div><div class="line">	w = Math.max(w1,w);</div><div class="line">	<span class="comment">//h = h;</span></div><div class="line">	setMeasuredDimension(</div><div class="line">			resolveSize(w, widthMeasureSpec), </div><div class="line">			resolveSize(h,heightMeasureSpec));</div><div class="line">};</div></pre></td></tr></table></figure>

<p>这里还需要说明的是当我们<code>onLayout()</code>的时候我们需要知道children的坐标和尺寸，尺寸不用担心，已经有了，但原点（左上角）坐标呢？这当然就是layout parameters的功用了，<code>LayoutParams</code>就是ViewGroup让children保存的数据，定义<code>LayoutParams</code>还是在ViewGroup中定义的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line"><span class="keyword">int</span> spacing = lp.spacing;</div><div class="line"><span class="comment">//Adjust your widths based on this spacing.</span></div></pre></td></tr></table></figure>

<p>具体的<code>LayoutParams</code>的定义还有ViewGroup如何调用它稍后再讲。</p>
<h3 id="4-onLayout()">4.onLayout()</h3>
<p>这里没太多可说的，直接依次调用<code>child.layout()</code>方法就行了，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span>(<span class="keyword">boolean</span> arg0, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, <span class="keyword">int</span> arg3, <span class="keyword">int</span> arg4) </div><div class="line">{</div><div class="line">	<span class="comment">//Call layout() on children</span></div><div class="line">	<span class="keyword">int</span> numOfChildren = <span class="keyword">this</span>.getChildCount();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; numOfChildren; i++ )</div><div class="line">	{</div><div class="line">		View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">		LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line">		child.layout(lp.x,</div><div class="line">				lp.y,</div><div class="line">				lp.x + child.getMeasuredWidth(), </div><div class="line">				lp.y + child.getMeasuredHeight());</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="5-自定义LayoutParams">5.自定义LayoutParams</h3>
<p>LayoutParams 是由child views生成和持有的，但是是在ViewGroup中定义的，原因很简单，ViewGroup需要child的这些信息，当然得由他来定义需要哪些信息。看代码吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="comment">//Custom Layout Definition </span></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutParams</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span>.<span class="title">MarginLayoutParams</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> spacing = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> x =<span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> y =<span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(Context c, AttributeSet attrs) {</div><div class="line">        <span class="keyword">super</span>(c, attrs);</div><div class="line">        TypedArray a =</div><div class="line">                c.obtainStyledAttributes(attrs, R.styleable.FlowLayout_Layout);</div><div class="line"></div><div class="line">        spacing = a.getDimensionPixelSize(R.styleable.FlowLayout_Layout_layout_space, <span class="number">0</span>);</div><div class="line">        Log.d(tag,<span class="string">"child spacing:"</span> + spacing);</div><div class="line">        a.recycle();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(<span class="keyword">int</span> width, <span class="keyword">int</span> height) {</div><div class="line">        <span class="keyword">super</span>(width, height);</div><div class="line">        spacing = <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">        <span class="keyword">super</span>(p);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(MarginLayoutParams source) {</div><div class="line">        <span class="keyword">super</span>(source);</div><div class="line">    }</div><div class="line">}<span class="comment">//eof-layout-params</span></div></pre></td></tr></table></figure>

<p>还有个问题，child的ViewGroup可以是LinearLayout 或者FlowLayout，child view是怎么知道该构造哪个布局的<code>LayoutParams</code>呢？这当然要Android SDK来解决了。当一个view被放到布局中时，框架会调用如下四个方法来构造view的<code>LayoutParams</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="comment">//Layout Param Support </span></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> LayoutParams <span class="title">generateLayoutParams</span>(AttributeSet attrs) {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FlowLayout.LayoutParams(getContext(), attrs);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> LayoutParams <span class="title">generateDefaultLayoutParams</span>() {</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> LayoutParams <span class="title">generateLayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(p);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Override to allow type-checking of LayoutParams.</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">checkLayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">    <span class="keyword">return</span> p <span class="keyword">instanceof</span> FlowLayout.LayoutParams;</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="6-稍微说下draw吧">6.稍微说下draw吧</h3>
<p>你当然可以在viewGroup上画点东西，当你想在所有child都画好后再话东西的话，就用<code>dispatchDraw()</code>，当然你得先call <code>super.dispatchDraw()</code>。现在画的东西就是在最上层。如果你想在child之前画点东西的话，当然就要用<code>onDraw()</code>了，注意，你先得配置<code>setWillNotDraw(false)</code>，因为默认ViewGroup是不会画东西的，就不会调用<code>onDraw()</code>。</p>
<h3 id="7-参考链接">7.参考链接</h3>
<p><a href="http://reacoder.github.io/2014/11/23/android-good-video/" target="_blank" rel="external">http://reacoder.github.io/2014/11/23/android-good-video/</a></p>
<p>《ExpertAndroid》</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-compound-view" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/29/android-compound-view/" class="article-date">
  	<time datetime="2014-11-29T04:04:15.000Z" itemprop="datePublished">Nov 29 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/29/android-compound-view/">android 自定义组合控件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概论：">概论：</h3>
<ol>
<li>说在前面的话</li>
<li>继承框架提供的布局</li>
<li>布局文件</li>
<li>构造方法</li>
<li>状态保存</li>
</ol>
<h3 id="1-说在前面的话">1.说在前面的话</h3>
<p><em>自定义组合控件还是蛮简单的，你不用measure，layout，draw，当然你想的话也可以在组合控件上做这些操作的，不过大多数时候是没有必要的。组合控件的自定义属性和自定义view完全一样，这里比较难的是状态保存，因为一个页面可以有很多个你自定义的组合控件，但是系统的状态保存是依赖viewID的，所以你不能让ViewGroup来管理你的控件状态，只能自己管理了。当然，你也可能不需要状态保存，那就很简单了。</em></p>
<p><strong>下面说说需要经历的步骤吧：</strong></p>
<ul>
<li>让自定义的组合控件继承框架提供的布局，如<code>LinearLayout</code>,<code>RelativeLayout</code>等。</li>
<li>把你组合控件里面的子控件放到一个布局文件中，然后在组合控件的构造方法中加载进来。</li>
<li>采用<code>merge</code>作为你布局文件的根，这样可以减少嵌套层次。</li>
<li>接下来是比较难的状态保存。</li>
<li>自定义属性，这个和自定义view一样。</li>
</ul>
<h3 id="2-继承框架提供的布局">2.继承框架提供的布局</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompoundControl</span></span></div><div class="line"><span class="keyword">extends</span> <span class="title">LinearLayout</span></div><div class="line"><span class="keyword">implements</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span>.<span class="title">OnClickListener</span></div><div class="line">{</div><div class="line">...</div></pre></td></tr></table></figure>

<h3 id="3-布局文件">3.布局文件</h3>
<p>样例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">merge</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span></div><div class="line">    <span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span></div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></div><div class="line">&gt;</div><div class="line"><span class="tag">&lt;<span class="title">TextView</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/fromDate"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Enter From Date"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"70"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;<span class="title">Button</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/fromButton"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Go"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"30"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span>        </div><div class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span></div><div class="line">    <span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span></div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></div><div class="line">&gt;</div><div class="line"><span class="tag">&lt;<span class="title">TextView</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/toDate"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Enter To Date"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"70"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;<span class="title">Button</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/toButton"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Go"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"30"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span>        </div><div class="line"><span class="tag">&lt;/<span class="title">merge</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="4-构造方法">4.构造方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context) {</div><div class="line">	<span class="keyword">super</span>(context);</div><div class="line">	initialize(context);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">	<span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">	TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">			R.styleable.DurationComponent, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">	durationUnits = t.getInt(R.styleable.DurationComponent_durationUnits,</div><div class="line">			durationUnits);</div><div class="line">	t.recycle();</div><div class="line">	initialize(context);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context, AttributeSet attrs) {</div><div class="line">	<span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span>(Context context) {</div><div class="line">	LayoutInflater lif = (LayoutInflater) context</div><div class="line">			.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</div><div class="line">	lif.inflate(R.layout.duration_view_layout, <span class="keyword">this</span>);</div><div class="line">	Button b = (Button) <span class="keyword">this</span>.findViewById(R.id.fromButton);</div><div class="line">	b.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">	b = (Button) <span class="keyword">this</span>.findViewById(R.id.toButton);</div><div class="line">	b.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.setSaveEnabled(<span class="keyword">true</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="5-状态保存">5.状态保存</h3>
<p><em>前面说过了，由于你控件可能会在一个页面出现多次，所以viewID会重复，这样系统就没办法帮你管理状态了。所以如果你要管理children的状态，就必须亲自动手了，而不是让children自己管理自己的状态。</em></p>
<p>要想管理children的状态，你必须要知道ViewGroup的四个状态管理的方法，他们是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dispatchSaveInstanceState</div><div class="line">dispatchFreezeSelfOnly</div><div class="line">dispatchRestoreInstanceState</div><div class="line">dispatchThawSelfOnly</div></pre></td></tr></table></figure>

<blockquote>
<p>A ViewGroup uses dispatchSaveInstanceState to first save its own state by calling super (view’s) dispatchSaveInstanceState, which in turn triggers onSaveInstanceState on itself and then calls the dispatchSaveInstanceState for each of its children. If the children are plain views and not ViewGroups, this will result in having their onSaveInstanceState called. Listing 2-12 presents the pseudo code for how these key methods are meshed together.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">ViewGroup.dispatchSaveInstanceState() {</div><div class="line">          View.dispatchSaveInstanceState()</div><div class="line">              ...ends up calling its own ViewGroup.onSaveInstanceState()</div><div class="line">          Children.dispatchSaveInstanceState()</div><div class="line">          ...ends up calling children's onSaveInstanceState()</div><div class="line">}</div><div class="line"></div><div class="line">View.dispatchSaveInstanceState() {</div><div class="line">        onSaveInstanceState()</div><div class="line">}</div><div class="line"></div><div class="line">ViewGroup.dispatchFreezeSelfOnly() {</div><div class="line">        View.dispatchSaveInstanceState()</div><div class="line">             ...ends up calling ViewGroup.onSaveInstanceState()</div><div class="line">}</div></pre></td></tr></table></figure>



<p>技巧在于<code>dispatchFreezeSelfOnly</code>,这个ViewGroup方法只是简单的保存了ViewGroup的状态，这同样也发生在对应的恢复<code>dispatchThawSelfOnly</code>上。所以你可以重写ViewGroup的方法来阻止children自己管理状态。如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span>(SparseArray&lt;Parcelable&gt; container)</div><div class="line">{</div><div class="line">  <span class="comment">//Don't call this so that children won't be explicitly saved</span></div><div class="line">  <span class="comment">//super.dispatchSaveInstanceState(container);</span></div><div class="line">  <span class="comment">//Call your self onsavedinstancestate</span></div><div class="line">  <span class="keyword">super</span>.dispatchFreezeSelfOnly(container);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchRestoreInstanceState</span>(</div><div class="line">   SparseArray&lt;Parcelable&gt; container)</div><div class="line">{</div><div class="line">  <span class="comment">//Don't call this so that children won't be explicitly saved</span></div><div class="line">  <span class="comment">//super.dispatchRestoreInstanceState(container);</span></div><div class="line">  <span class="keyword">super</span>.dispatchThawSelfOnly(container);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>接下来就需要ViewGroup在<code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code>中管理children的状态了，实例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span>(SparseArray&lt;Parcelable&gt; container) {</div><div class="line">	<span class="comment">// Don't call this so that children won't be explicitly saved</span></div><div class="line">	<span class="comment">// super.dispatchSaveInstanceState(container);</span></div><div class="line">	<span class="comment">// Call your self onsavedinstancestate</span></div><div class="line">	<span class="keyword">super</span>.dispatchFreezeSelfOnly(container);</div><div class="line">	Log.d(tag, <span class="string">"in dispatchSaveInstanceState"</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchRestoreInstanceState</span>(</div><div class="line">		SparseArray&lt;Parcelable&gt; container) {</div><div class="line">	<span class="comment">// Don't call this so that children won't be explicitly saved</span></div><div class="line">	<span class="comment">// .super.dispatchRestoreInstanceState(container);</span></div><div class="line">	<span class="keyword">super</span>.dispatchThawSelfOnly(container);</div><div class="line">	Log.d(tag, <span class="string">"in dispatchRestoreInstanceState"</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span>(Parcelable state) {</div><div class="line">	Log.d(tag, <span class="string">"in onRestoreInstanceState"</span>);</div><div class="line">	<span class="keyword">if</span> (!(state <span class="keyword">instanceof</span> SavedState)) {</div><div class="line">		<span class="keyword">super</span>.onRestoreInstanceState(state);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">// it is our state</span></div><div class="line">	SavedState ss = (SavedState) state;</div><div class="line">	<span class="comment">// Peel it and give the child to the super class</span></div><div class="line">	<span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</div><div class="line">	<span class="comment">// this.fromDate = ss.fromDate;</span></div><div class="line">	<span class="comment">// this.toDate= ss.toDate;</span></div><div class="line">	<span class="keyword">this</span>.setFromDate(ss.fromDate);</div><div class="line">	<span class="keyword">this</span>.setToDate(ss.toDate);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> Parcelable <span class="title">onSaveInstanceState</span>() {</div><div class="line">	Log.d(tag, <span class="string">"in onSaveInstanceState"</span>);</div><div class="line">	Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	SavedState ss = <span class="keyword">new</span> SavedState(superState);</div><div class="line">	ss.fromDate = <span class="keyword">this</span>.fromDate;</div><div class="line">	ss.toDate = <span class="keyword">this</span>.toDate;</div><div class="line">	<span class="keyword">return</span> ss;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Saved State inner static class</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedState</span> <span class="keyword">extends</span> <span class="title">BaseSavedState</span> </span>{</div><div class="line">	<span class="comment">// null values are allowed</span></div><div class="line">	<span class="keyword">private</span> Calendar fromDate;</div><div class="line">	<span class="keyword">private</span> Calendar toDate;</div><div class="line"></div><div class="line">	SavedState(Parcelable superState) {</div><div class="line">		<span class="keyword">super</span>(superState);</div><div class="line">	}</div><div class="line"></div><div class="line">	SavedState(Parcelable superState, Calendar inFromDate, Calendar inToDate) {</div><div class="line">		<span class="keyword">super</span>(superState);</div><div class="line">		fromDate = inFromDate;</div><div class="line">		toDate = inToDate;</div><div class="line">	}</div><div class="line">	<span class="annotation">@Override</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span>(Parcel out, <span class="keyword">int</span> flags) {</div><div class="line">		<span class="keyword">super</span>.writeToParcel(out, flags);</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (fromDate != <span class="keyword">null</span>) {</div><div class="line">			out.writeLong(fromDate.getTimeInMillis());</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			out.writeLong(-<span class="number">1</span>L);</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (fromDate != <span class="keyword">null</span>) {</div><div class="line">			out.writeLong(toDate.getTimeInMillis());</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			out.writeLong(-<span class="number">1</span>L);</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="annotation">@Override</span></div><div class="line">	<span class="keyword">public</span> String <span class="title">toString</span>() {</div><div class="line">		StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">"fromDate:"</span></div><div class="line">				+ DurationControl.getDateString(fromDate));</div><div class="line">		sb.append(<span class="string">"fromDate:"</span> + DurationControl.getDateString(toDate));</div><div class="line">		<span class="keyword">return</span> sb.toString();</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="annotation">@SuppressWarnings</span>(<span class="string">"hiding"</span>)</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;SavedState&gt; CREATOR </div><div class="line">	   = <span class="keyword">new</span> Parcelable.Creator&lt;SavedState&gt;() {</div><div class="line">		<span class="keyword">public</span> SavedState <span class="title">createFromParcel</span>(Parcel in) {</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> SavedState(in);</div><div class="line">		}</div><div class="line"></div><div class="line">		<span class="keyword">public</span> SavedState[] <span class="title">newArray</span>(<span class="keyword">int</span> size) {</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> SavedState[size];</div><div class="line">		}</div><div class="line">	};</div><div class="line"></div><div class="line">	<span class="comment">// Read back the values</span></div><div class="line">	<span class="keyword">private</span> <span class="title">SavedState</span>(Parcel in) {</div><div class="line">		<span class="keyword">super</span>(in);</div><div class="line"></div><div class="line">		<span class="comment">// Read the from date</span></div><div class="line">		<span class="keyword">long</span> lFromDate = in.readLong();</div><div class="line">		<span class="keyword">if</span> (lFromDate == -<span class="number">1</span>) {</div><div class="line">			fromDate = <span class="keyword">null</span>;</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			fromDate = Calendar.getInstance();</div><div class="line">			fromDate.setTimeInMillis(lFromDate);</div><div class="line">		}</div><div class="line">		<span class="comment">// Read the from date</span></div><div class="line">		<span class="keyword">long</span> lToDate = in.readLong();</div><div class="line">		<span class="keyword">if</span> (lFromDate == -<span class="number">1</span>) {</div><div class="line">			toDate = <span class="keyword">null</span>;</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			toDate = Calendar.getInstance();</div><div class="line">			toDate.setTimeInMillis(lToDate);</div><div class="line">		}</div><div class="line">	}</div><div class="line">}<span class="comment">// eof-state-class</span></div></pre></td></tr></table></figure>

<p><em>其实这就相当于把整个组合控件当成一个View来管理</em></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-custom-view" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/28/android-custom-view/" class="article-date">
  	<time datetime="2014-11-28T08:35:39.000Z" itemprop="datePublished">Nov 28 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/28/android-custom-view/">android 自定义View</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概览：">概览：</h3>
<ol>
<li>View 的生命周期</li>
<li>Traversals</li>
<li>Measure</li>
<li>Draw</li>
<li>Custom Attributes</li>
<li>监听事件很简单，不讲了</li>
<li>状态保存</li>
<li>参考链接</li>
</ol>
<h3 id="1-_View_的生命周期">1. View 的生命周期</h3>
<ul>
<li>Attachment/detachment（一般不用care）</li>
<li>Traversals（必须care）</li>
<li>State save/restore（看你的需求了）</li>
</ul>
<p>Attachment的回调接口是<code>onAttachedToWindow()</code>，在这里你可以做以下操作</p>
<ul>
<li>Call super.onAttachedToWindow()!</li>
<li>Perform any relevant state resets</li>
<li>Start listening for state changes</li>
</ul>
<p>detachment的回调接口是<code>onDetachedFromWindow()</code>，在这里你可以做以下操作</p>
<ul>
<li>Call super.onDetachedFromWindow()!</li>
<li>Remove any posted Runnables</li>
<li>Stop listening for data changes</li>
<li>Clean up resources <ul>
<li>Bitmaps</li>
<li>Threads</li>
</ul>
</li>
</ul>
<p>看看官方的<code>SwipeRefreshLayout</code>的运用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span>() {</div><div class="line">    <span class="keyword">super</span>.onAttachedToWindow();</div><div class="line">    removeCallbacks(mCancel);</div><div class="line">    removeCallbacks(mReturnToStartPosition);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span>() {</div><div class="line">    <span class="keyword">super</span>.onDetachedFromWindow();</div><div class="line">    removeCallbacks(mReturnToStartPosition);</div><div class="line">    removeCallbacks(mCancel);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>打个简单地比喻就是，如果你的View和网络操作相关的话，最好在这里做取消操作。它这里的操作其实就是取消或重置动画。好了，这里就不多说了，一般用不到。下面说说遍历Traversals。</p>
<h3 id="2-_Traversals">2. Traversals</h3>
<p>Traversals 分四个阶段</p>
<p><strong>Animate—&gt;Measure—&gt;Layout—&gt;Draw</strong></p>
<p>我们现在关心的是Measure和Draw，分别对应<code>onMeasure()</code>,<code>onDraw()</code>,先看看View的默认实现吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) {</div><div class="line">    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</div><div class="line">            getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getDefaultSize</span>(<span class="keyword">int</span> size, <span class="keyword">int</span> measureSpec) {</div><div class="line">    <span class="keyword">int</span> result = size;</div><div class="line">    <span class="keyword">int</span> specMode = MeasureSpec.getMode(measureSpec);</div><div class="line">    <span class="keyword">int</span> specSize = MeasureSpec.getSize(measureSpec);</div><div class="line"></div><div class="line">    <span class="keyword">switch</span> (specMode) {</div><div class="line">    <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</div><div class="line">        result = size;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MeasureSpec.AT_MOST:</div><div class="line">    <span class="keyword">case</span> MeasureSpec.EXACTLY:</div><div class="line">        result = specSize;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">}    </div><div class="line">    </div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span>(Canvas canvas) {</div><div class="line">}</div></pre></td></tr></table></figure>

<p>现在来看看具体的Measure</p>
<h3 id="3-_Measure">3. Measure</h3>
<p>如果你自定义的View没有特殊尺寸要求的话，也可以不重写<code>onMeasure()</code>。现在来说说比较难理解的MeasureSpec 模式，三张图搞定它</p>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emqt5tk0q6j20xf0gmq4u.jpg" alt="MeasureSpec.EXACTLY"></p>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emqt5ue98bj20xp0gkwg0.jpg" alt="MeasureSpec.AT_MOST"></p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emqt5u7ni2j20z00gp404.jpg" alt="MeasureSpec.UNSPECIFIED"></p>
<p>在<code>onMeasure()</code>里由于没有回调，框架依赖你最后设置尺寸，所以你一定要调用<code>setMeasuredDimension()</code>,否则运行时会crash。</p>
<p>看看大牛Dave Smith 给的一个模板吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) {</div><div class="line">    <span class="comment">//Get the width measurement</span></div><div class="line">    <span class="keyword">int</span> widthSize = MeasureUtils.getMeasurement(widthMeasureSpec, getDesiredWidth());</div><div class="line"></div><div class="line">    <span class="comment">//Get the height measurement</span></div><div class="line">    <span class="keyword">int</span> heightSize = MeasureUtils.getMeasurement(heightMeasureSpec, getDesiredHeight());</div><div class="line"></div><div class="line">    <span class="comment">//MUST call this to store the measurements</span></div><div class="line">    setMeasuredDimension(widthSize, heightSize);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>工具方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MeasureUtils</span> </span>{</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * Utility to return a view's standard measurement. Uses the</div><div class="line">     * supplied size when constraints are given. Attempts to</div><div class="line">     * hold to the desired size unless it conflicts with provided</div><div class="line">     * constraints.</div><div class="line">     *</div><div class="line">     *<span class="javadoctag"> @param</span> measureSpec Constraints imposed by the parent</div><div class="line">     *<span class="javadoctag"> @param</span> contentSize Desired size for the view</div><div class="line">     *<span class="javadoctag"> @return</span> The size the view should be.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMeasurement</span>(<span class="keyword">int</span> measureSpec, <span class="keyword">int</span> contentSize) {</div><div class="line">        <span class="keyword">int</span> specMode = View.MeasureSpec.getMode(measureSpec);</div><div class="line">        <span class="keyword">int</span> specSize = View.MeasureSpec.getSize(measureSpec);</div><div class="line">        <span class="keyword">int</span> resultSize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (specMode) {</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.UNSPECIFIED:</div><div class="line">                <span class="comment">//Big as we want to be</span></div><div class="line">                resultSize = contentSize;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.AT_MOST:</div><div class="line">                <span class="comment">//Big as we want to be, up to the spec</span></div><div class="line">                resultSize = Math.min(contentSize, specSize);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.EXACTLY:</div><div class="line">                <span class="comment">//Must be the spec size</span></div><div class="line">                resultSize = specSize;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> resultSize;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="4-_Draw">4. Draw</h3>
<p>这其实没有太多要说的，<code>onDraw()</code>回调已经给你了一个Canvas，你要做的就是画各种你需要的东西了。看看Canvas的官方定义吧：</p>
<blockquote>
<p>The Canvas class holds the “draw” calls. To draw something, you need 4 basic components: A Bitmap to hold the pixels, a Canvas to host the draw calls (writing into the bitmap), a drawing primitive (e.g. Rect, Path, text, Bitmap), and a paint (to describe the colors and styles for the drawing).</p>
</blockquote>
<p>这里的Canvas已经包含一个mutable 的Bitmap了。需要注意的是<code>onDraw()</code>调用的很频繁，实例化对象的操作应该都放到外面。随便看个例子吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span>(Canvas canvas) {</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    Log.d(tag,<span class="string">"onDraw called"</span>);</div><div class="line">    <span class="keyword">int</span> w = <span class="keyword">this</span>.getWidth();</div><div class="line">    <span class="keyword">int</span> h = <span class="keyword">this</span>.getHeight();</div><div class="line">    <span class="keyword">int</span> t = <span class="keyword">this</span>.getTop();</div><div class="line">    <span class="keyword">int</span> l = <span class="keyword">this</span>.getLeft();</div><div class="line">    <span class="keyword">int</span> ox = w/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> oy = h/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> rad = Math.min(ox,oy)/<span class="number">2</span>;</div><div class="line">    canvas.drawCircle(ox, oy, rad, getBrush());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>其实这里的获取宽高的操作应该放到<code>onSizeChanged()</code>里面，这个是在<code>onLayout()</code>里调用的，而且一般只遍历一次。</p>
<h3 id="5-_Custom_Attributes">5. Custom Attributes</h3>
<p>这个没什么要讲的，看例子就理解了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Listing 1-18. Defining Custom Attributes in attrs.xml</div><div class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"CircleView"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"strokeWidth"</span> <span class="attribute">format</span>=<span class="value">"integer"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"strokeColor"</span> <span class="attribute">format</span>=<span class="value">"color|reference"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></div></pre></td></tr></table></figure>

<p>下面这段好好理解<br>Given the attrs.xml in Listing 1-18, Android generates the following IDs:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">R.attr.strokeWidth (<span class="keyword">int</span>)</div><div class="line">R.attr.srokeColor (<span class="keyword">int</span>)</div><div class="line">R.styleable.CircelView (an array of ints)</div><div class="line">R.styleable.CircleView_strokeWidth (offset into the array)</div><div class="line">R.styleable.CircelView_strokeColor (offset into the array)</div></pre></td></tr></table></figure>

<p>在初始化时</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="title">CircleView</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">    <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">    <span class="comment">//Use the array constant to read the bag once</span></div><div class="line">    TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">                     R.styleable.CircleView,</div><div class="line">                     defStyle, <span class="comment">//if any values are in the theme</span></div><div class="line">                     <span class="number">0</span>); <span class="comment">//Do you have your own style group</span></div><div class="line">    <span class="comment">//Use the offset in the bag to get your value</span></div><div class="line">    strokeColor = t.getColor(R.styleable.CircleView_strokeColor, mDefaultStrokeColor);</div><div class="line">    strokeWidth = t.getInt(R.styleable.CircleView_strokeWidth, mDefaultStrokeWidth);</div><div class="line">    <span class="comment">//Recycle the typed array</span></div><div class="line">    t.recycle();</div><div class="line">    <span class="comment">//Go ahead and initialize your class.</span></div><div class="line">    initCircleView();</div><div class="line">}</div></pre></td></tr></table></figure>

<blockquote>
<p>DON’T FORGET: TypedArrays are heavyweight objects that should be recycled immediately after all the attributes you need have been extracted.</p>
</blockquote>
<h3 id="6-_监听事件很简单，不讲了">6. 监听事件很简单，不讲了</h3>
<h3 id="7-_状态保存">7. 状态保存</h3>
<p>用系统的方式保存状态，万无一失，下面看模板:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Save and restore work</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span>(Parcelable p)</div><div class="line">{</div><div class="line">	<span class="keyword">this</span>.onRestoreInstanceStateStandard(p);</div><div class="line">	<span class="keyword">this</span>.initCircleView();</div><div class="line">}</div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> Parcelable <span class="title">onSaveInstanceState</span>()</div><div class="line">{</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.onSaveInstanceStateStandard();</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Use a simpler approach</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceStateSimple</span>(Parcelable p)</div><div class="line">{</div><div class="line">	<span class="keyword">if</span> (!(p <span class="keyword">instanceof</span> Bundle))</div><div class="line">	{</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"unexpected bundle"</span>);</div><div class="line">	}</div><div class="line">	Bundle b = (Bundle)p;</div><div class="line">	defRadius = b.getInt(<span class="string">"defRadius"</span>);</div><div class="line">	Parcelable sp = b.getParcelable(<span class="string">"super"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//No need to call parent. It is just a base view</span></div><div class="line">	<span class="keyword">super</span>.onRestoreInstanceState(sp);</div><div class="line">}</div><div class="line"><span class="keyword">private</span> Parcelable <span class="title">onSaveInstanceStateSimple</span>()</div><div class="line">{</div><div class="line">	<span class="comment">//Don't call the base class as it will return a null</span></div><div class="line">	Parcelable p = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	Bundle b = <span class="keyword">new</span> Bundle();</div><div class="line">	b.putInt(<span class="string">"defRadius"</span>,defRadius);</div><div class="line">	b.putParcelable(<span class="string">"super"</span>,p);</div><div class="line">	<span class="keyword">return</span> b;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Use a standard approach</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceStateStandard</span>(Parcelable state)</div><div class="line">{</div><div class="line">	<span class="comment">//If it is not yours doesn't mean it is BaseSavedState</span></div><div class="line">	<span class="comment">//You may have a parent in your hierarchy that has their own </span></div><div class="line">	<span class="comment">//state derived from BaseSavedState</span></div><div class="line">	<span class="comment">//It is like peeling an onion or a Russian doll</span></div><div class="line">	<span class="keyword">if</span> (!(state <span class="keyword">instanceof</span> SavedState)) {</div><div class="line">        <span class="keyword">super</span>.onRestoreInstanceState(state);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    }    </div><div class="line">	<span class="comment">//it is our state</span></div><div class="line">	SavedState ss = (SavedState)state;</div><div class="line">	<span class="comment">//Peel it and give the child to the super class</span></div><div class="line">    <span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</div><div class="line">    </div><div class="line">    defRadius = ss.defRadius;</div><div class="line">}</div><div class="line"><span class="keyword">private</span> Parcelable <span class="title">onSaveInstanceStateStandard</span>()</div><div class="line">{</div><div class="line">	Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	SavedState ss = <span class="keyword">new</span> SavedState(superState);</div><div class="line">	ss.defRadius = <span class="keyword">this</span>.defRadius;</div><div class="line">	<span class="keyword">return</span> ss;    	</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Saved State inner static class</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedState</span> <span class="keyword">extends</span> <span class="title">BaseSavedState</span> </span>{</div><div class="line">    <span class="keyword">int</span> defRadius;</div><div class="line"></div><div class="line">    SavedState(Parcelable superState) {</div><div class="line">        <span class="keyword">super</span>(superState);</div><div class="line">    }</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span>(Parcel out, <span class="keyword">int</span> flags) {</div><div class="line">        <span class="keyword">super</span>.writeToParcel(out, flags);</div><div class="line">        out.writeInt(defRadius);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//Read back the values</span></div><div class="line">    <span class="keyword">private</span> <span class="title">SavedState</span>(Parcel in) {</div><div class="line">        <span class="keyword">super</span>(in);</div><div class="line">        defRadius = in.readInt();</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> String <span class="title">toString</span>() {</div><div class="line">    	<span class="keyword">return</span> <span class="string">"CircleView defRadius:"</span> + defRadius;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"hiding"</span>)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;SavedState&gt; CREATOR</div><div class="line">            = <span class="keyword">new</span> Parcelable.Creator&lt;SavedState&gt;() {</div><div class="line">        <span class="keyword">public</span> SavedState <span class="title">createFromParcel</span>(Parcel in) {</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SavedState(in);</div><div class="line">        }</div><div class="line">        <span class="keyword">public</span> SavedState[] <span class="title">newArray</span>(<span class="keyword">int</span> size) {</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SavedState[size];</div><div class="line">        }</div><div class="line">    };</div><div class="line"></div><div class="line">}<span class="comment">//eof-state-class</span></div></pre></td></tr></table></figure>

<p>注意：你需要在初始化时，调用<code>this.setSaveEnabled(true);</code>,当然，状态保存也不是必须的，看你的需求了。</p>
<h3 id="8-_参考链接">8. 参考链接</h3>
<p><a href="https://www.youtube.com/watch?v=NYtB6mlu7vA" target="_blank" rel="external">https://www.youtube.com/watch?v=NYtB6mlu7vA</a><br><a href="https://thenewcircle.com/s/post/1663/tutorial_enhancing_android_ui_with_custom_views_dave_smith_video" target="_blank" rel="external">https://thenewcircle.com/s/post/1663/tutorial_enhancing_android_ui_with_custom_views_dave_smith_video</a><br><a href="https://dl.dropboxusercontent.com/u/16714463/Google%20IO%202014/Material%20Witness.pdf" target="_blank" rel="external">https://dl.dropboxusercontent.com/u/16714463/Google%20IO%202014/Material%20Witness.pdf</a><br><a href="http://developer.android.com/training/custom-views/index.html" target="_blank" rel="external">http://developer.android.com/training/custom-views/index.html</a><br><a href="http://developer.android.com/guide/topics/ui/custom-components.html" target="_blank" rel="external">http://developer.android.com/guide/topics/ui/custom-components.html</a></p>
<p>《Expert Android》</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/26/android-tutorial/" class="article-date">
  	<time datetime="2014-11-26T07:21:37.000Z" itemprop="datePublished">Nov 26 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/26/android-tutorial/">android 学习资源</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://developer.android.com/assets/images/dac_logo@2x.png" alt="developer"></p>
<p><a href="http://developer.android.com/training/basics/firstapp/index.html" target="_blank" rel="external">http://developer.android.com/training/basics/firstapp/index.html</a></p>
<hr>
<p><img src="http://i.imgur.com/XgxWfyF.png" alt="codepath"></p>
<p><a href="http://guides.codepath.com/android" target="_blank" rel="external">http://guides.codepath.com/android</a></p>
<hr>
<p><img src="http://www.vogella.com/img/logo/xindex_logo.png.pagespeed.ic.S0rT7Uq_V2.png" alt="vogella"></p>
<p><a href="http://www.vogella.com/tutorials/android.html" target="_blank" rel="external">http://www.vogella.com/tutorials/android.html</a></p>
<hr>
<p><strong>Android Programming Tutorials</strong></p>
<p><a href="http://www.edumobile.org/android/" target="_blank" rel="external">http://www.edumobile.org/android/</a></p>
<hr>
<p><img src="http://www.technotalkative.com/wp-content/uploads/2013/11/tt_logo.png" alt=""></p>
<p><a href="http://www.technotalkative.com/category/android/" target="_blank" rel="external">http://www.technotalkative.com/category/android/</a></p>
<hr>
<p><img src="http://sampleprogramz.com/images/android/android.png" alt=""></p>
<p><a href="http://sampleprogramz.com/android/slidingdrawer.php" target="_blank" rel="external">http://sampleprogramz.com/android/slidingdrawer.php</a></p>
<hr>
<p><img src="http://ogrelab.ikratko.com/wp-content/themes/ogrelab/images/logo.png" alt=""></p>
<p><a href="http://ogrelab.ikratko.com/category/java/android/" target="_blank" rel="external">http://ogrelab.ikratko.com/category/java/android/</a></p>
<hr>
<p><img src="http://www.jayway.com/wp-content/uploads/2014/05/Jayway_logotype_180_invert.png" alt=""></p>
<p><a href="http://www.jayway.com/tag/android/" target="_blank" rel="external">http://www.jayway.com/tag/android/</a></p>
<hr>
<p><img src="http://square.github.io/images/logo.png" alt=""></p>
<p><a href="http://square.github.io/" target="_blank" rel="external">http://square.github.io/</a></p>
<hr>
<p><img src="http://vinsol.com/blog/wp-content/themes/Vinsol2.0BlogTheme/images/vin_logo.png" alt=""></p>
<p><a href="http://vinsol.com/blog/" target="_blank" rel="external">http://vinsol.com/blog/</a></p>
<hr>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-blog-you-need-to-reed" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/26/blog-you-need-to-reed/" class="article-date">
  	<time datetime="2014-11-26T06:45:47.000Z" itemprop="datePublished">Nov 26 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/26/blog-you-need-to-reed/">国外大牛们的博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://androidweekly.net/assets/newsletter/logo_new-d0c4136e89ff4c744dce6560c27a7050.png" align="middle" width="50" height="50">    </p>
<p><strong>Android Weekly</strong></p>
<ul>
<li><a href="http://androidweekly.net/" target="_blank" rel="external">BlogSite</a></li>
</ul>
<hr>
<p><img src="http://3.bp.blogspot.com/-l7gnNEh4qg8/UKqmMerltLI/AAAAAAAAC-c/_aid9jTg9Zk/s1600/blogheader2.png" align="middle" width="50" height="50">     </p>
<p><strong>Android Developers Blog</strong></p>
<ul>
<li><p><a href="http://android-developers.blogspot.jp/" target="_blank" rel="external">BlogSite</a></p>
<hr>
</li>
</ul>
<p><img src="https://avatars1.githubusercontent.com/u/215725?v=3&s=400" align="middle" width="5" height="50"></p>
<p><strong>Dave Smith</strong></p>
<ul>
<li><p><a href="http://wiresareobsolete.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/devunwired" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://avatars0.githubusercontent.com/u/869684?v=3&s=460" align="middle" width="50" height="50">    </p>
<p><strong>Romain Guy</strong></p>
<ul>
<li><p><a href="http://www.curious-creature.org/category/android/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/romainguy" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="http://chiuki.github.io/images/chiuki.jpg" align="middle" width="50" height="50">    </p>
<p><strong>Chiu-Ki Chan</strong></p>
<ul>
<li><p><a href="http://chiuki.github.io/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/chiuki" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://avatars2.githubusercontent.com/u/514850?v=3&s=400" align="middle" width="50" height="50">    </p>
<p><strong>Daniel Lew</strong></p>
<ul>
<li><p><a href="http://blog.danlew.net/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/dlew" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="http://androidweekly.net/assets/landingpage/testimonials/allison-8286c45d212168fec809d5be0f26c3a7.jpg" align="middle" width="50" height="50">    </p>
<p><strong>Mark Allison</strong></p>
<ul>
<li><p><a href="http://blog.stylingandroid.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/StylingAndroid" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://avatars1.githubusercontent.com/u/2179751?v=3&s=460" align="middle" width="50" height="50">    </p>
<p><strong>Wolfram Rittmeyer</strong></p>
<ul>
<li><p><a href="http://www.grokkingandroid.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/writtmeyer" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="http://ecx.images-amazon.com/images/I/61dHJJsXxFL._UX250_.jpg" align="middle" width="50" height="50">    </p>
<p><strong>Mark Murphy</strong></p>
<ul>
<li><p><a href="http://commonsware.com/blog/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/commonsguy" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://avatars2.githubusercontent.com/u/92794?v=3&s=460" align="middle" width="50" height="50">    </p>
<p><strong>Cyril Mottier</strong></p>
<ul>
<li><p><a href="http://cyrilmottier.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/cyrilmottier" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="http://martin.cubeactive.com/wp-content/uploads/2010/06/2d1a206b-46e0-4407-9579-3fdbbd6337e8-150x150.jpg" align="middle" width="50" height="50">    </p>
<p><strong>Martin van Zuilekom</strong></p>
<ul>
<li><p><a href="http://martin.cubeactive.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/MartinvanZ" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://chris.banes.me/content/images/me.jpg" align="middle" width="50" height="50">    </p>
<p><strong>Chris Banes</strong></p>
<ul>
<li><p><a href="https://chris.banes.me/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/chrisbanes" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><img src="https://avatars0.githubusercontent.com/u/2178243?v=3&s=400" align="middle" width="50" height="50">    </p>
<p><strong>Antonio Leiva</strong></p>
<ul>
<li><p><a href="http://antonioleiva.com/" target="_blank" rel="external">BlogSite</a></p>
</li>
<li><p><a href="https://github.com/antoniolg" target="_blank" rel="external">GitHub</a></p>
</li>
</ul>
<hr>
<p><strong>More</strong></p>
<p><a href="https://github.com/android-cn/android-dev-com" target="_blank" rel="external">https://github.com/android-cn/android-dev-com</a></p>
<p><a href="https://github.com/android-cn/android-dev-cn" target="_blank" rel="external">https://github.com/android-cn/android-dev-cn</a></p>
<p><a href="https://github.com/futurice/android-best-practices" target="_blank" rel="external">https://github.com/futurice/android-best-practices</a></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-develop-note" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/25/android-develop-note/" class="article-date">
  	<time datetime="2014-11-25T04:55:06.000Z" itemprop="datePublished">Nov 25 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/note/">note</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/25/android-develop-note/">android 开发全纪录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="">ActionBar</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/custom-ActionMode" target="_blank" rel="external">custom ActionMode</a></li>
</ul>
<p><a href="">Activity</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/drawerLayout-framework" target="_blank" rel="external">drawerLayout framework</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/view-page-indicator-framework" target="_blank" rel="external">view page indicator framework</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/blob/master/PRE_andevcon_mastering-the-android-touch-system.pdf" target="_blank" rel="external">mastering the android touch system</a></li>
</ul>
<p><a href="">Animation</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/listview-animation" target="_blank" rel="external">listview animation</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/activity-animation" target="_blank" rel="external">activity animation</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/listview-item-show-animation" target="_blank" rel="external">listview item show animation</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/listview-item-show-animation-better" target="_blank" rel="external">listview item show animation better</a></li>
</ul>
<p><a href="">APK</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/Get-apk-file-icon,-version,-name" target="_blank" rel="external">Get apk file icon, version, name</a></li>
<li><a href="http://stackoverflow.com/questions/6813322/install-uninstall-apks-programmatically-packagemanager-vs-intents" target="_blank" rel="external">install / uninstall APKs programmatically (PackageManager vs Intents)</a></li>
</ul>
<p><a href="">App</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/app-can-move-to-SDCard-or-not" target="_blank" rel="external">app can move to SDCard or not</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/get-memory-usage-of-apps" target="_blank" rel="external">get memory usage of apps</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/get-user-installed-apps-and-apps&#39;-size" target="_blank" rel="external">get user installed apps and apps’ size</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/get-running-apps-and-their-memory" target="_blank" rel="external">get running apps and their memory</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/free-all-apps&#39;-cache" target="_blank" rel="external">free all apps’ cache</a></li>
</ul>
<p><a href="">DB</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/get-picture-of-music" target="_blank" rel="external">get picture of music</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/greenDao-generator-java-project" target="_blank" rel="external">greenDao generator java project</a></li>
</ul>
<p><a href="">Gradle</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/build.gradle-and-proguard" target="_blank" rel="external">build.gradle and proguard</a></li>
</ul>
<p><a href="">Hardware</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/AirplaneUtil" target="_blank" rel="external">AirplaneUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/BluetoothUtil" target="_blank" rel="external">BluetoothUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/FlashLightUtil" target="_blank" rel="external">FlashLightUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/GPRSUtil" target="_blank" rel="external">GPRSUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/GPSUtil" target="_blank" rel="external">GPSUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/MuteModeUtil" target="_blank" rel="external">MuteModeUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/RotateUtil" target="_blank" rel="external">RotateUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/ScreenBrightUtil" target="_blank" rel="external">ScreenBrightUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/ScreenOffUtil" target="_blank" rel="external">ScreenOffUtil</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/WifiUtil" target="_blank" rel="external">WifiUtil</a></li>
</ul>
<p><a href="">Intent</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/Android-%E5%B8%B8%E7%94%A8-mimeType-%E8%A1%A8" target="_blank" rel="external">Android 常用 mimeType 表</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/open-default-calculator" target="_blank" rel="external">open default calculator</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/get-alarm,calculator,gallery,camera,battery,share-intent" target="_blank" rel="external">get alarm,calculator,gallery,camera,battery,share intent</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/open-uninstall-setting-page" target="_blank" rel="external">open uninstall setting page</a></li>
</ul>
<p><a href="">ListView</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/cancel-listView-scroll" target="_blank" rel="external">cancel listView scroll</a></li>
</ul>
<p><a href="">Shortcut</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/make-launcher-shortcut-for-boost." target="_blank" rel="external">make launcher shortcut for boost.</a></li>
</ul>
<p><a href="">TextView</a></p>
<ul>
<li><a href="http://orgcent.com/android-textview-spannablestring-span/" target="_blank" rel="external">TextView使用SpannableString设置复合文本</a></li>
<li><a href="http://blog.csdn.net/lixin84915/article/details/8110667" target="_blank" rel="external"> Android文本样式</a></li>
</ul>
<p><a href="">Util</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/string-util-include-date" target="_blank" rel="external">string util include date</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/SystemUtil-with-ram,temperature,storage,music,pictures" target="_blank" rel="external">SystemUtil with ram,temperature,storage,music,pictures</a></li>
</ul>
<p><a href="">View</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/CheckableTextView" target="_blank" rel="external">CheckableTextView</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/CheckBox-with-different-bg" target="_blank" rel="external">CheckBox with different bg</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/Dashboard" target="_blank" rel="external">Dashboard</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/RightUpperCornerText" target="_blank" rel="external">RightUpperCornerText</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/SearchView" target="_blank" rel="external">SearchView</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/custom-progress-bar" target="_blank" rel="external">custom progress bar</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/custom-video-controller" target="_blank" rel="external">custom video controller</a></li>
<li><a href="https://github.com/Reacoder/AndroidDevelopNote/wiki/custom-progress-circle" target="_blank" rel="external">custom progress circle</a></li>
</ul>
<p><a href="">Window</a></p>
<ul>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/open-popup-window" target="_blank" rel="external">open popup window</a></li>
<li><a href="https://github.com/sampythoner/AndroidDevelopNote/wiki/add-global-player-window-which-can-move-in-Y" target="_blank" rel="external">add global player window which can move in Y</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  

      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Reacoder
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>