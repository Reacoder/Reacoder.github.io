<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Reacoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Reacoder">
<meta property="og:url" content="http://reacoder.github.io/page/2/">
<meta property="og:site_name" content="Reacoder">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reacoder">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="Reacoder" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://tp2.sinaimg.cn/1918409225/180/40039469631/1">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">Reacoder</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/categories/Android/">Android</a></li>
				        
							<li><a href="/2014/12/01/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Reacoder" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/1918409225" title="weibo">weibo</a>
					        
								<a class="google" target="_blank" href="https://plus.google.com/u/0/117706805140071058584/posts" title="google">google</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud">
						<a href="/tags/Studio/" style="font-size: 10.00px;">Studio</a><a href="/tags/adb/" style="font-size: 10.00px;">adb</a><a href="/tags/animation/" style="font-size: 10.00px;">animation</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/canvas/" style="font-size: 10.00px;">canvas</a><a href="/tags/cmd/" style="font-size: 10.00px;">cmd</a><a href="/tags/customView/" style="font-size: 20.00px;">customView</a><a href="/tags/db/" style="font-size: 10.00px;">db</a><a href="/tags/drawer/" style="font-size: 10.00px;">drawer</a><a href="/tags/git/" style="font-size: 10.00px;">git</a><a href="/tags/gradle/" style="font-size: 10.00px;">gradle</a><a href="/tags/hexo/" style="font-size: 15.00px;">hexo</a><a href="/tags/image/" style="font-size: 10.00px;">image</a><a href="/tags/js/" style="font-size: 10.00px;">js</a><a href="/tags/listview/" style="font-size: 15.00px;">listview</a><a href="/tags/menu/" style="font-size: 10.00px;">menu</a><a href="/tags/nodejs/" style="font-size: 10.00px;">nodejs</a><a href="/tags/note/" style="font-size: 10.00px;">note</a><a href="/tags/spannableString/" style="font-size: 10.00px;">spannableString</a><a href="/tags/sql/" style="font-size: 10.00px;">sql</a><a href="/tags/textView/" style="font-size: 10.00px;">textView</a><a href="/tags/timeHelper/" style="font-size: 10.00px;">timeHelper</a><a href="/tags/toolBar/" style="font-size: 10.00px;">toolBar</a><a href="/tags/toolbar/" style="font-size: 15.00px;">toolbar</a><a href="/tags/touchEvent/" style="font-size: 15.00px;">touchEvent</a><a href="/tags/tutorial/" style="font-size: 10.00px;">tutorial</a><a href="/tags/video/" style="font-size: 10.00px;">video</a><a href="/tags/webView/" style="font-size: 10.00px;">webView</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://tp2.sinaimg.cn/1918409225/180/40039469631/1">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">Reacoder</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/Android/">Android</a></li>
		        
					<li><a href="/2014/12/01/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Reacoder" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1918409225" title="weibo">weibo</a>
			        
						<a class="google" target="_blank" href="https://plus.google.com/u/0/117706805140071058584/posts" title="google">google</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      
  
    <article id="post-irregular-image-shape" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/12/05/irregular-image-shape/" class="article-date">
  	<time datetime="2014-12-05T02:10:24.000Z" itemprop="datePublished">Dec 5 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/image/">image</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/05/irregular-image-shape/">如何裁剪图片(圆角图片)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概览:">概览:</h3>
<ol>
<li>采用Porter-Duff 图片合成方法</li>
<li>采用Shader着色器重新绘制图片</li>
<li>不规则图片裁剪</li>
<li>心形图片裁剪</li>
<li>参考链接</li>
</ol>
<p><em>先看下效果：</em></p>
<p><img src="http://ww4.sinaimg.cn/small/72589a09gw1emylfap6unj20f00qo41j.jpg" alt=""> <img src="http://ww1.sinaimg.cn/small/72589a09gw1emylfbfdpqj20f00qo775.jpg" alt=""> <img src="http://ww4.sinaimg.cn/small/72589a09gw1emylfbzr4nj20f00qotaz.jpg" alt=""></p>
<h3 id="1-_采用Porter-Duff_图片合成方法">1. 采用Porter-Duff 图片合成方法</h3>
<p><em>先说说Porter-Duff是什么意思：Porter-Duff是Thomas Porter 和 Tom Duff 的简称，就是两个人名字的合成。</em></p>
<blockquote>
<p>Porter-Duff 操作是 1 组 12 项用于描述数字图像合成的基本手法，包括<br>Clear、Source Only、Destination Only、Source Over、Source In、Source<br>Out、Source Atop、Destination Over、Destination In、Destination<br>Out、Destination Atop、XOR。<strong>通过组合使用 Porter-Duff 操作，可完成任意 2D<br>图像的合成。</strong></p>
</blockquote>
<p>合成图片，顾名思义就是拿两张图片取需要的部分放到第三张图片上，合成一张新的图片。</p>
<p>看看我们采用的两张图片吧：</p>
<p><img src="http://ww4.sinaimg.cn/small/72589a09gw1emylf9nrc0j20b40etgnw.jpg" alt=""> <img src="http://ww2.sinaimg.cn/small/72589a09gw1emylfa6jp9j20b40ett8l.jpg" alt=""></p>
<p>绿色的mask并不会把小狗整成绿色，因为合成的时候只取了mask的形状，alpha值为0。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Part1Fragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>{</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> View <span class="title">onCreateView</span>(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {</div><div class="line">        View view = inflater.inflate(R.layout.fragment_layout, container, <span class="keyword">false</span>);</div><div class="line">        ImageView image = (ImageView) view.findViewById(R.id.image);</div><div class="line">        Bitmap dog = BitmapFactory.decodeResource(container.getResources(), R.drawable.betty);</div><div class="line">        Bitmap mask = BitmapFactory.decodeResource(container.getResources(), R.drawable.mask);</div><div class="line">        image.setImageBitmap(combineImages(mask, dog));</div><div class="line">        dog.recycle();</div><div class="line">        mask.recycle();</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Bitmap <span class="title">combineImages</span>(Bitmap mask, Bitmap dog) {</div><div class="line">        Bitmap bmp;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> width = mask.getWidth() &gt; dog.getWidth() ? mask.getWidth() : dog.getWidth();</div><div class="line">        <span class="keyword">int</span> height = mask.getHeight() &gt; dog.getHeight() ? mask.getHeight() : dog.getHeight();</div><div class="line"></div><div class="line">        bmp = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setXfermode(<span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_ATOP));</div><div class="line"></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        canvas.drawBitmap(mask, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">        canvas.drawBitmap(dog, <span class="number">0</span>, <span class="number">0</span>, paint);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>合成之后就变成圆角图片了，如下：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emylfap6unj20f00qo41j.jpg" alt=""></p>
<p><strong>原理：</strong> 我们先是用两张图片的最大尺寸创建了一个<code>mutable</code>的<code>Bitmap</code>，用来作为<code>Canvas</code>的画东西的地方。然后先画了mask，即<code>Dst</code>，接着把画笔<code>Paint</code> 的<code>XFerMode</code>设置成<code>SRC_ATOP</code>，然后把dog画上去，这样就实现了裁剪效果。</p>
<p>估计你不太理解我说的东西，看下面一张图你就明白了(蓝色正方形是<code>Src</code>，就是你将要画上去的东西，黄色圆圈是<code>Dst</code>，即原来画布上有的东西)：</p>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emyls3fjgyj20fk0hsn0i.jpg" alt=""></p>
<p>上面是一种合成方式，<strong>看另外一种合成方式：</strong></p>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emyls4l7ajj20qq0ol76x.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emyls5jo08j21060mkgpk.jpg" alt=""></p>
<p>好了，效果是达到了，但这样做有没有问题呢？<strong>问题如下：</strong></p>
<ul>
<li>mask的尺寸必须和原图一致，我们当然可以缩放mask，但如果缩放的宽高比和原图不一致会出现失真。</li>
<li>最大的问题还是效率！为了实现裁剪，我们加载了两个图，如果图片很大就会<code>OutOfMemoryError</code>。</li>
</ul>
<h3 id="2-_采用Shader着色器重新绘制图片">2. 采用Shader着色器重新绘制图片</h3>
<p><code>Shaders</code>着色器让我们可以在画东西的时候定义填充风格，<code>Shaders</code>是设置在画笔上的。<code>BitmapShader</code>是用一张<code>Bitmap</code>着色，而且还支持三种瓦片铺盖方式。所谓瓦片铺盖方式就是当我们画的区域比采用的Bitmap还大时，超出部分该怎么画。如下图(小方块就代表<code>Bitmap</code>)：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emyls3tem3j20jk08k3z1.jpg" alt=""></p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Part2Fragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>{</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> RADIUS_FACTOR = <span class="number">8.0</span>f;</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> View <span class="title">onCreateView</span>(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {</div><div class="line">        View view = inflater.inflate(R.layout.fragment_layout, container, <span class="keyword">false</span>);</div><div class="line">        ImageView image = (ImageView)view.findViewById(R.id.image);</div><div class="line">        Bitmap bitmap = BitmapFactory.decodeResource(container.getResources(), R.drawable.betty);</div><div class="line">        image.setImageBitmap(processImage(bitmap));</div><div class="line">        bitmap.recycle();</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Bitmap <span class="title">processImage</span>(Bitmap bitmap) {</div><div class="line">        Bitmap bmp;</div><div class="line"></div><div class="line">        bmp = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        BitmapShader shader = <span class="keyword">new</span> BitmapShader(bitmap, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> radius = Math.min(bitmap.getWidth(), bitmap.getHeight()) / RADIUS_FACTOR;</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setShader(shader);</div><div class="line"></div><div class="line">        RectF rect = <span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight());</div><div class="line">        canvas.drawRoundRect(rect, radius, radius, paint);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emylfap6unj20f00qo41j.jpg" alt=""></p>
<h3 id="3-_不规则图片裁剪">3. 不规则图片裁剪</h3>
<p>对话框气泡，原理是一样的，看代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Part3Fragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>{</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> RADIUS_FACTOR = <span class="number">8.0</span>f;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIANGLE_WIDTH = <span class="number">120</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIANGLE_HEIGHT = <span class="number">100</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIANGLE_OFFSET = <span class="number">300</span>;</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> View <span class="title">onCreateView</span>(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {</div><div class="line">        View view = inflater.inflate(R.layout.fragment_layout, container, <span class="keyword">false</span>);</div><div class="line">        ImageView image = (ImageView)view.findViewById(R.id.image);</div><div class="line">        Bitmap bitmap = BitmapFactory.decodeResource(container.getResources(), R.drawable.betty);</div><div class="line">        image.setImageBitmap(processImage(bitmap));</div><div class="line">        bitmap.recycle();</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Bitmap <span class="title">processImage</span>(Bitmap bitmap) {</div><div class="line">        Bitmap bmp;</div><div class="line"></div><div class="line">        bmp = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        BitmapShader shader = <span class="keyword">new</span> BitmapShader(bitmap, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> radius = Math.min(bitmap.getWidth(), bitmap.getHeight()) / RADIUS_FACTOR;</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setShader(shader);</div><div class="line"></div><div class="line">        RectF rect = <span class="keyword">new</span> RectF(TRIANGLE_WIDTH, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight());</div><div class="line">        canvas.drawRoundRect(rect, radius, radius, paint);</div><div class="line"></div><div class="line">        Path triangle = <span class="keyword">new</span> Path();</div><div class="line">        triangle.moveTo(<span class="number">0</span>, TRIANGLE_OFFSET);</div><div class="line">        triangle.lineTo(TRIANGLE_WIDTH, TRIANGLE_OFFSET - (TRIANGLE_HEIGHT / <span class="number">2</span>));</div><div class="line">        triangle.lineTo(TRIANGLE_WIDTH, TRIANGLE_OFFSET + (TRIANGLE_HEIGHT / <span class="number">2</span>));</div><div class="line">        triangle.close();</div><div class="line">        canvas.drawPath(triangle, paint);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>效果如下:</p>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emylfbfdpqj20f00qo775.jpg" alt=""></p>
<h3 id="4-_心形图片裁剪">4. 心形图片裁剪</h3>
<p>先设置<code>BitmapShader</code>, <code>Canvas</code>, 和 <code>Paint</code> 对象:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Bitmap bmp;</div><div class="line"> </div><div class="line">bmp = Bitmap.createBitmap(bitmap.getWidth(), </div><div class="line">    bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">BitmapShader shader = <span class="keyword">new</span> BitmapShader(bitmap, </div><div class="line">    BitmapShader.TileMode.CLAMP, </div><div class="line">    BitmapShader.TileMode.CLAMP);</div><div class="line"> </div><div class="line">Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">paint.setShader(shader);</div></pre></td></tr></table></figure>

<p>再初始化一些后面需要用到的东西：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">float</span> width = bitmap.getWidth();</div><div class="line"><span class="keyword">float</span> height = bitmap.getHeight();</div><div class="line"></div><div class="line">Path oval = <span class="keyword">new</span> Path();</div><div class="line">Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">Region region = <span class="keyword">new</span> Region();</div></pre></td></tr></table></figure>

<p>把长方形变成椭圆：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RectF ovalRect = <span class="keyword">new</span> RectF(width / <span class="number">8</span>, <span class="number">0</span>, </div><div class="line">    width - (width / <span class="number">8</span>), height);</div><div class="line">    </div><div class="line">oval.addOval(ovalRect, Path.Direction.CW);</div></pre></td></tr></table></figure>

<p>得到如下图形：</p>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emylfcmsu8j20f00qoacb.jpg" alt=""></p>
<p>旋转30度：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">matrix.postRotate(<span class="number">30</span>, width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">oval.transform(matrix, oval);</div></pre></td></tr></table></figure>

<p>得到如下图形：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emylfd8juhj20f00qodi3.jpg" alt=""></p>
<p>再用<code>Region</code>裁剪:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">region.setPath(oval, <span class="keyword">new</span> Region((<span class="keyword">int</span>)width / <span class="number">2</span>, <span class="number">0</span>, </div><div class="line">    (<span class="keyword">int</span>)width, (<span class="keyword">int</span>)height));</div><div class="line">canvas.drawPath(region.getBoundaryPath(), paint);</div></pre></td></tr></table></figure>

<p>得到如下图形：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emylfdwiolj20f00qoabj.jpg" alt=""></p>
<p>同理再画另一边，画之前先复位:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">matrix.reset();</div><div class="line">oval.reset();</div></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">oval.addOval(ovalRect, Path.Direction.CW);</div><div class="line">matrix.postRotate(-<span class="number">30</span>, width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">oval.transform(matrix, oval);</div><div class="line">region.setPath(oval, </div><div class="line">    <span class="keyword">new</span> Region(<span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">int</span>)width / <span class="number">2</span>, (<span class="keyword">int</span>)height));</div><div class="line">canvas.drawPath(region.getBoundaryPath(), paint);</div></pre></td></tr></table></figure>

<p>得到如下图形：</p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emylfbzr4nj20f00qotaz.jpg" alt=""></p>
<p>全部代码放一起如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Part4Fragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>{</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> View <span class="title">onCreateView</span>(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {</div><div class="line">        View view = inflater.inflate(R.layout.fragment_layout, container, <span class="keyword">false</span>);</div><div class="line">        ImageView image = (ImageView)view.findViewById(R.id.image);</div><div class="line">        Bitmap bitmap = BitmapFactory.decodeResource(container.getResources(), R.drawable.betty);</div><div class="line">        image.setImageBitmap(processImage(bitmap));</div><div class="line">        bitmap.recycle();</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Bitmap <span class="title">processImage</span>(Bitmap bitmap) {</div><div class="line">        Bitmap bmp;</div><div class="line"></div><div class="line">        bmp = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        BitmapShader shader = <span class="keyword">new</span> BitmapShader(bitmap, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP);</div><div class="line"></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setShader(shader);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> width = bitmap.getWidth();</div><div class="line">        <span class="keyword">float</span> height = bitmap.getHeight();</div><div class="line"></div><div class="line">        Path oval = <span class="keyword">new</span> Path();</div><div class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">        Region region = <span class="keyword">new</span> Region();</div><div class="line">        RectF ovalRect = <span class="keyword">new</span> RectF(width / <span class="number">8</span>, <span class="number">0</span>, width - (width / <span class="number">8</span>), height);</div><div class="line"></div><div class="line">        oval.addOval(ovalRect, Path.Direction.CW);</div><div class="line">        matrix.postRotate(<span class="number">30</span>, width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">        oval.transform(matrix, oval);</div><div class="line">        region.setPath(oval, <span class="keyword">new</span> Region((<span class="keyword">int</span>)width / <span class="number">2</span>, <span class="number">0</span>, (<span class="keyword">int</span>)width, (<span class="keyword">int</span>)height));</div><div class="line">        canvas.drawPath(region.getBoundaryPath(), paint);</div><div class="line"></div><div class="line">        matrix.reset();</div><div class="line">        oval.reset();</div><div class="line">        oval.addOval(ovalRect, Path.Direction.CW);</div><div class="line">        matrix.postRotate(-<span class="number">30</span>, width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">        oval.transform(matrix, oval);</div><div class="line">        region.setPath(oval, <span class="keyword">new</span> Region(<span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">int</span>)width / <span class="number">2</span>, (<span class="keyword">int</span>)height));</div><div class="line">        canvas.drawPath(region.getBoundaryPath(), paint);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="5-_参考链接">5. 参考链接</h3>
<p><a href="http://www.douban.com/note/143111853/" target="_blank" rel="external">http://www.douban.com/note/143111853/</a></p>
<p><a href="http://blog.stylingandroid.com/category/canvas/" target="_blank" rel="external">http://blog.stylingandroid.com/category/canvas/</a></p>
<p><a href="http://chiuki.github.io/android-shaders-filters/#/" target="_blank" rel="external">http://chiuki.github.io/android-shaders-filters/#/</a></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-about" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/12/01/about/" class="article-date">
  	<time datetime="2014-12-01T09:12:10.000Z" itemprop="datePublished">Dec 1 2014</time>
</a>
      
      
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/01/about/">关于我</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>华中科技大学08级，Android程序员，目前在上海联接工作…</strong></p>
<p><em>开发过的应用：</em></p>
<hr>
<p>MusicTube，播放YouTube视频，也可以下载</p>
<ul>
<li><a href="http://www.amazon.com/MusicTube-Trailers-Singles-YouTube-download/dp/B00LX15X5W/ref=sr_1_1?ie=UTF8&amp;qid=1417422789&amp;sr=8-1&amp;keywords=musictube" target="_blank" rel="external">MusicTube(亚马逊市场)</a></li>
<li><a href="http://vdisk.weibo.com/s/dyk_6CfP2t-xF/1417425580" target="_blank" rel="external">MusicTube(我的微盘)</a></li>
</ul>
<hr>
<p>TubePlayer，登陆YouTube账号，管理你的订阅等，观看下载视频。</p>
<ul>
<li><a href="http://vdisk.weibo.com/s/dyk_6CfP2t-xl/1417425447" target="_blank" rel="external">TubePlayer(我的微盘)</a></li>
</ul>
<hr>
<p>CleanMaster，清理手机垃圾和内存。</p>
<ul>
<li><a href="https://play.google.com/store/apps/details?id=com.toprankapps.cleanmaster" target="_blank" rel="external">CleanMaster(谷歌市场)</a></li>
<li><a href="http://vdisk.weibo.com/s/dyk_6CfP2t-0C/1417425675" target="_blank" rel="external">CleanMaster(我的微盘)</a></li>
</ul>
<hr>
<p><em>联系我：</em></p>
<p><a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#58;&#115;&#x61;&#x6d;&#112;&#x79;&#x74;&#x68;&#111;&#110;&#x65;&#x72;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#x63;&#x6f;&#x6d;">&#115;&#x61;&#x6d;&#112;&#x79;&#x74;&#x68;&#111;&#110;&#x65;&#x72;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#x63;&#x6f;&#x6d;</a></p>
<p><a href="&#109;&#x61;&#x69;&#108;&#116;&#x6f;&#x3a;&#x35;&#56;&#x32;&#x39;&#x30;&#54;&#53;&#x38;&#56;&#x40;&#113;&#113;&#x2e;&#99;&#x6f;&#109;">&#x35;&#56;&#x32;&#x39;&#x30;&#54;&#53;&#x38;&#56;&#x40;&#113;&#113;&#x2e;&#99;&#x6f;&#109;</a></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-touch-event" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/30/android-touch-event/" class="article-date">
  	<time datetime="2014-11-30T10:10:39.000Z" itemprop="datePublished">Nov 30 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/touchEvent/">touchEvent</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/30/android-touch-event/">android touch事件传递机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-先看3张图吧">1.先看3张图吧</h3>
<p><strong>child不消费touch事件</strong><br><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emt81ohhksj20sk0i5mzb.jpg" alt=""></p>
<hr>
<p><strong>child消费touch事件</strong><br><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emt81pb1ozj20si0jitaz.jpg" alt=""></p>
<hr>
<p><strong>ViewGroup截获touch事件</strong><br><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt81qnrgdj20sk0j6jtl.jpg" alt=""></p>
<h3 id="2-Android是怎么处理touch事件的？">2.Android是怎么处理touch事件的？</h3>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt8rcubgqj20r10it0va.jpg" alt=""></p>
<hr>
<p><img src="http://ww2.sinaimg.cn/mw690/72589a09gw1emt8rdph4fj20ri0ijn13.jpg" alt=""></p>
<hr>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emt8rei94nj20r00i8dix.jpg" alt=""></p>
<hr>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emt8rfc4f6j20qh0idwi4.jpg" alt=""></p>
<h3 id="3-自定义touch事件处理">3.自定义touch事件处理</h3>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt8rg6jc7j20ok0id77i.jpg" alt=""></p>
<hr>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt8rgtuivj20qr0i677z.jpg" alt=""></p>
<hr>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt8rhib0nj20ri0hhdjq.jpg" alt=""></p>
<h3 id="4-系统提供的touch事件监听处理函数">4.系统提供的touch事件监听处理函数</h3>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emt8ri60j4j20s10hnn08.jpg" alt=""></p>
<hr>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emt8ritrusj20qj0i2ad7.jpg" alt=""></p>
<h3 id="5-更多关于多点触控和事件委托">5.更多关于多点触控和事件委托</h3>
<p>文档见 <a href="http://vdisk.weibo.com/s/dyk_6CfP2FIz_" target="_blank" rel="external">http://vdisk.weibo.com/s/dyk_6CfP2FIz_</a></p>
<p>或者<br><a href="http://files.cnblogs.com/sunzn/PRE_andevcon_mastering-the-android-touch-system.pdf" target="_blank" rel="external">http://files.cnblogs.com/sunzn/PRE_andevcon_mastering-the-android-touch-system.pdf</a></p>
<p>视频<br><a href="https://www.youtube.com/watch?v=EZAoJU-nUyI" target="_blank" rel="external">https://www.youtube.com/watch?v=EZAoJU-nUyI</a></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-custom-viewgroup" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/29/android-custom-viewgroup/" class="article-date">
  	<time datetime="2014-11-29T13:06:23.000Z" itemprop="datePublished">Nov 29 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/29/android-custom-viewgroup/">android 自定义ViewGroup</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概论：">概论：</h3>
<ol>
<li>三种自定义的比较</li>
<li>继承自ViewGroup</li>
<li>onMeasure()</li>
<li>onLayout()</li>
<li>自定义LayoutParams</li>
<li>稍微说下draw吧</li>
<li>参考链接</li>
</ol>
<h3 id="1-三种自定义的比较">1.三种自定义的比较</h3>
<p><strong>Custom Views</strong></p>
<ul>
<li>Extending the View</li>
<li>Overriding onMeasure()</li>
<li>Overriding onDraw()</li>
<li>Saving state using the BaseSavedState pattern</li>
<li>Working with custom attributes</li>
<li>Understanding and applying requestLayout and invalidate</li>
</ul>
<p><em>In contrast, you can ignore the following details when creating custom views:</em></p>
<ul>
<li>Overriding onLayout()</li>
<li>Implementating and using LayoutParams</li>
</ul>
<hr>
<p><strong>Compound Controls</strong></p>
<ul>
<li>Extend an existing layout</li>
<li>Saving state using the BaseSavedState pattern </li>
<li>Taking control of saving state for its child views </li>
<li>Working with custom attributes</li>
</ul>
<p><em>While you can ignore:</em></p>
<ul>
<li>Overriding onMeasure()</li>
<li>Overriding onDraw()</li>
<li>Overriding onLayout()</li>
<li>Worrying about requestLayout() and invalidate() </li>
<li>Implementing and using LayoutParams</li>
</ul>
<hr>
<p><strong>Custom Layouts</strong></p>
<ol>
<li>Inherit from ViewGroup</li>
<li>Override onMeasure()</li>
<li>Override onLayout()</li>
<li>Implement custom LayoutParams with any additional layout attributes</li>
<li>Override layout parameters construction methods in the custom layout class</li>
</ol>
<h3 id="2-继承自ViewGroup">2.继承自ViewGroup</h3>
<p>流水线布局的样子：<br><img src="http://ww2.sinaimg.cn/mw690/72589a09gw1ems6lryrsij20cb09yaal.jpg" alt=""></p>
<p>这里的代码和自定义view差不多，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span></div><div class="line">{</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String tag=<span class="string">"FlowLayout"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> hspace=<span class="number">10</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> vspace=<span class="number">10</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context) {</div><div class="line">		<span class="keyword">super</span>(context);</div><div class="line">		initialize(context);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">		<span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">		TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">				R.styleable.FlowLayout, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">		hspace = t.getDimensionPixelSize(R.styleable.FlowLayout_hspace,</div><div class="line">				hspace);</div><div class="line">		vspace = t.getDimensionPixelSize(R.styleable.FlowLayout_vspace,</div><div class="line">				vspace);</div><div class="line">		Log.d(tag,<span class="string">"hspace:"</span> + hspace);</div><div class="line">		Log.d(tag,<span class="string">"vspace:"</span> + vspace);</div><div class="line">		t.recycle();</div><div class="line">		initialize(context);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="title">FlowLayout</span>(Context context, AttributeSet attrs) {</div><div class="line">		<span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span>(Context context) {</div><div class="line">	}</div><div class="line">	...</div><div class="line">}</div></pre></td></tr></table></figure>

<p>就是自定义属性多了个布局属性，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"FlowLayout"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"hspace"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"vspace"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"FlowLayout_Layout"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"layout_space"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="3-onMeasure()">3.onMeasure()</h3>
<p>这里需要注意的地方比较多，也有点难理解。<br>由于是<code>ViewGroup</code>，你需要先measure children，但是比不能直接用<del><code>child.measure()</code></del>，因为这个方法完全没考虑ViewGroup的MeasureSpec，你应该用的是<code>ViewGroup.measureChild()</code>。到最后你<code>setMeasuredDimension()</code>，还需要用<code>resolveSize(w, widthMeasureSpec)</code>来计算ViewGroup的实际尺寸，因为你所有的children的尺寸有可能超出ViewGroup的尺寸，所以框架提供了这个方便的方法让我们使用。</p>
<p>看下这个图有助于了解接下来的代码：<br><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1ems7kdsk6qj20hc0emgmc.jpg" alt=""></p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//This is very basic</span></div><div class="line"><span class="comment">//doesn't take into account padding</span></div><div class="line"><span class="comment">//You can easily modify it to account for padding</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) </div><div class="line">{</div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="comment">//Initialize</span></div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="keyword">int</span> rw = MeasureSpec.getSize(widthMeasureSpec);</div><div class="line">	<span class="keyword">int</span> rh = MeasureSpec.getSize(heightMeasureSpec);</div><div class="line">	<span class="keyword">int</span> h = <span class="number">0</span>; <span class="comment">//current height</span></div><div class="line">	<span class="keyword">int</span> w = <span class="number">0</span>; <span class="comment">//current width</span></div><div class="line">	<span class="keyword">int</span> h1 = <span class="number">0</span>, w1=<span class="number">0</span>; <span class="comment">//Current point to hook the child to</span></div><div class="line">	</div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="comment">//Loop through children</span></div><div class="line">	<span class="comment">//********************</span></div><div class="line">	<span class="keyword">int</span> numOfChildren = <span class="keyword">this</span>.getChildCount();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; numOfChildren; i++ )</div><div class="line">	{</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Front of the loop</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">		<span class="keyword">this</span>.measureChild(child,widthMeasureSpec, heightMeasureSpec);</div><div class="line">		<span class="keyword">int</span> vw = child.getMeasuredWidth();</div><div class="line">		<span class="keyword">int</span> vh = child.getMeasuredHeight();</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (w1 + vw &gt; rw)</div><div class="line">		{</div><div class="line">			<span class="comment">//new line: max of current width and current width position</span></div><div class="line">			<span class="comment">//when multiple lines are in play w could be maxed out</span></div><div class="line">			<span class="comment">//or in uneven sizes is the max of the right side lines</span></div><div class="line">			<span class="comment">//all lines don't have to have the same width</span></div><div class="line">			<span class="comment">//some may be larger than others</span></div><div class="line">			w = Math.max(w,w1);</div><div class="line">			<span class="comment">//reposition the point on the next line</span></div><div class="line">			w1 = <span class="number">0</span>; <span class="comment">//start of the line</span></div><div class="line">			h1 = h1 + vh; <span class="comment">//add view height to the current heigh</span></div><div class="line">		}</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Middle of the loop</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="keyword">int</span> w2 = <span class="number">0</span>, h2 = <span class="number">0</span>; <span class="comment">//new point for the next view</span></div><div class="line">		w2 = w1 + vw;</div><div class="line">		h2 = h1;</div><div class="line">		<span class="comment">//latest height: current point + height of the view</span></div><div class="line">		<span class="comment">//however if the previous height is larger use that one</span></div><div class="line">		h = Math.max(h,h1 + vh);</div><div class="line">		</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Save the current coords for the view </span></div><div class="line">		<span class="comment">//in its layout</span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line">		lp.x = w1;</div><div class="line">		lp.y = h1;</div><div class="line">	</div><div class="line">		<span class="comment">//********************</span></div><div class="line">		<span class="comment">//Restart the loop </span></div><div class="line">		<span class="comment">//********************</span></div><div class="line">		w1=w2;</div><div class="line">		h1=h2;</div><div class="line">	}</div><div class="line"><span class="comment">//********************</span></div><div class="line"><span class="comment">//End of for </span></div><div class="line"><span class="comment">//********************</span></div><div class="line">	w = Math.max(w1,w);</div><div class="line">	<span class="comment">//h = h;</span></div><div class="line">	setMeasuredDimension(</div><div class="line">			resolveSize(w, widthMeasureSpec), </div><div class="line">			resolveSize(h,heightMeasureSpec));</div><div class="line">};</div></pre></td></tr></table></figure>

<p>这里还需要说明的是当我们<code>onLayout()</code>的时候我们需要知道children的坐标和尺寸，尺寸不用担心，已经有了，但原点（左上角）坐标呢？这当然就是layout parameters的功用了，<code>LayoutParams</code>就是ViewGroup让children保存的数据，定义<code>LayoutParams</code>还是在ViewGroup中定义的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line"><span class="keyword">int</span> spacing = lp.spacing;</div><div class="line"><span class="comment">//Adjust your widths based on this spacing.</span></div></pre></td></tr></table></figure>

<p>具体的<code>LayoutParams</code>的定义还有ViewGroup如何调用它稍后再讲。</p>
<h3 id="4-onLayout()">4.onLayout()</h3>
<p>这里没太多可说的，直接依次调用<code>child.layout()</code>方法就行了，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span>(<span class="keyword">boolean</span> arg0, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, <span class="keyword">int</span> arg3, <span class="keyword">int</span> arg4) </div><div class="line">{</div><div class="line">	<span class="comment">//Call layout() on children</span></div><div class="line">	<span class="keyword">int</span> numOfChildren = <span class="keyword">this</span>.getChildCount();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; numOfChildren; i++ )</div><div class="line">	{</div><div class="line">		View child = <span class="keyword">this</span>.getChildAt(i);</div><div class="line">		LayoutParams lp = (LayoutParams)child.getLayoutParams();</div><div class="line">		child.layout(lp.x,</div><div class="line">				lp.y,</div><div class="line">				lp.x + child.getMeasuredWidth(), </div><div class="line">				lp.y + child.getMeasuredHeight());</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="5-自定义LayoutParams">5.自定义LayoutParams</h3>
<p>LayoutParams 是由child views生成和持有的，但是是在ViewGroup中定义的，原因很简单，ViewGroup需要child的这些信息，当然得由他来定义需要哪些信息。看代码吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="comment">//Custom Layout Definition </span></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutParams</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span>.<span class="title">MarginLayoutParams</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> spacing = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> x =<span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> y =<span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(Context c, AttributeSet attrs) {</div><div class="line">        <span class="keyword">super</span>(c, attrs);</div><div class="line">        TypedArray a =</div><div class="line">                c.obtainStyledAttributes(attrs, R.styleable.FlowLayout_Layout);</div><div class="line"></div><div class="line">        spacing = a.getDimensionPixelSize(R.styleable.FlowLayout_Layout_layout_space, <span class="number">0</span>);</div><div class="line">        Log.d(tag,<span class="string">"child spacing:"</span> + spacing);</div><div class="line">        a.recycle();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(<span class="keyword">int</span> width, <span class="keyword">int</span> height) {</div><div class="line">        <span class="keyword">super</span>(width, height);</div><div class="line">        spacing = <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">        <span class="keyword">super</span>(p);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">LayoutParams</span>(MarginLayoutParams source) {</div><div class="line">        <span class="keyword">super</span>(source);</div><div class="line">    }</div><div class="line">}<span class="comment">//eof-layout-params</span></div></pre></td></tr></table></figure>

<p>还有个问题，child的ViewGroup可以是LinearLayout 或者FlowLayout，child view是怎么知道该构造哪个布局的<code>LayoutParams</code>呢？这当然要Android SDK来解决了。当一个view被放到布局中时，框架会调用如下四个方法来构造view的<code>LayoutParams</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="comment">//Layout Param Support </span></div><div class="line"><span class="comment">//*********************************************************</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> LayoutParams <span class="title">generateLayoutParams</span>(AttributeSet attrs) {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FlowLayout.LayoutParams(getContext(), attrs);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> LayoutParams <span class="title">generateDefaultLayoutParams</span>() {</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> LayoutParams <span class="title">generateLayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LayoutParams(p);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Override to allow type-checking of LayoutParams.</span></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">checkLayoutParams</span>(ViewGroup.LayoutParams p) {</div><div class="line">    <span class="keyword">return</span> p <span class="keyword">instanceof</span> FlowLayout.LayoutParams;</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="6-稍微说下draw吧">6.稍微说下draw吧</h3>
<p>你当然可以在viewGroup上画点东西，当你想在所有child都画好后再话东西的话，就用<code>dispatchDraw()</code>，当然你得先call <code>super.dispatchDraw()</code>。现在画的东西就是在最上层。如果你想在child之前画点东西的话，当然就要用<code>onDraw()</code>了，注意，你先得配置<code>setWillNotDraw(false)</code>，因为默认ViewGroup是不会画东西的，就不会调用<code>onDraw()</code>。</p>
<h3 id="7-参考链接">7.参考链接</h3>
<p><a href="http://reacoder.github.io/2014/11/23/android-good-video/" target="_blank" rel="external">http://reacoder.github.io/2014/11/23/android-good-video/</a></p>
<p>《ExpertAndroid》</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-compound-view" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/29/android-compound-view/" class="article-date">
  	<time datetime="2014-11-29T04:04:15.000Z" itemprop="datePublished">Nov 29 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/29/android-compound-view/">android 自定义组合控件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概论：">概论：</h3>
<ol>
<li>说在前面的话</li>
<li>继承框架提供的布局</li>
<li>布局文件</li>
<li>构造方法</li>
<li>状态保存</li>
</ol>
<h3 id="1-说在前面的话">1.说在前面的话</h3>
<p><em>自定义组合控件还是蛮简单的，你不用measure，layout，draw，当然你想的话也可以在组合控件上做这些操作的，不过大多数时候是没有必要的。组合控件的自定义属性和自定义view完全一样，这里比较难的是状态保存，因为一个页面可以有很多个你自定义的组合控件，但是系统的状态保存是依赖viewID的，所以你不能让ViewGroup来管理你的控件状态，只能自己管理了。当然，你也可能不需要状态保存，那就很简单了。</em></p>
<p><strong>下面说说需要经历的步骤吧：</strong></p>
<ul>
<li>让自定义的组合控件继承框架提供的布局，如<code>LinearLayout</code>,<code>RelativeLayout</code>等。</li>
<li>把你组合控件里面的子控件放到一个布局文件中，然后在组合控件的构造方法中加载进来。</li>
<li>采用<code>merge</code>作为你布局文件的根，这样可以减少嵌套层次。</li>
<li>接下来是比较难的状态保存。</li>
<li>自定义属性，这个和自定义view一样。</li>
</ul>
<h3 id="2-继承框架提供的布局">2.继承框架提供的布局</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompoundControl</span></span></div><div class="line"><span class="keyword">extends</span> <span class="title">LinearLayout</span></div><div class="line"><span class="keyword">implements</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span>.<span class="title">OnClickListener</span></div><div class="line">{</div><div class="line">...</div></pre></td></tr></table></figure>

<h3 id="3-布局文件">3.布局文件</h3>
<p>样例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">merge</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span></div><div class="line">    <span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span></div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></div><div class="line">&gt;</div><div class="line"><span class="tag">&lt;<span class="title">TextView</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/fromDate"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Enter From Date"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"70"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;<span class="title">Button</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/fromButton"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Go"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"30"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span>        </div><div class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span></div><div class="line">    <span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span></div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></div><div class="line">&gt;</div><div class="line"><span class="tag">&lt;<span class="title">TextView</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/toDate"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Enter To Date"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"70"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;<span class="title">Button</span>  </span></div><div class="line">	<span class="attribute">android:id</span>=<span class="value">"@+id/toButton"</span></div><div class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span> </div><div class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> </div><div class="line">    <span class="attribute">android:text</span>=<span class="value">"Go"</span></div><div class="line">    <span class="attribute">android:layout_weight</span>=<span class="value">"30"</span> </div><div class="line">    /&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span>        </div><div class="line"><span class="tag">&lt;/<span class="title">merge</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="4-构造方法">4.构造方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context) {</div><div class="line">	<span class="keyword">super</span>(context);</div><div class="line">	initialize(context);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">	<span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">	TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">			R.styleable.DurationComponent, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">	durationUnits = t.getInt(R.styleable.DurationComponent_durationUnits,</div><div class="line">			durationUnits);</div><div class="line">	t.recycle();</div><div class="line">	initialize(context);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="title">DurationControl</span>(Context context, AttributeSet attrs) {</div><div class="line">	<span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span>(Context context) {</div><div class="line">	LayoutInflater lif = (LayoutInflater) context</div><div class="line">			.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</div><div class="line">	lif.inflate(R.layout.duration_view_layout, <span class="keyword">this</span>);</div><div class="line">	Button b = (Button) <span class="keyword">this</span>.findViewById(R.id.fromButton);</div><div class="line">	b.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">	b = (Button) <span class="keyword">this</span>.findViewById(R.id.toButton);</div><div class="line">	b.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.setSaveEnabled(<span class="keyword">true</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="5-状态保存">5.状态保存</h3>
<p><em>前面说过了，由于你控件可能会在一个页面出现多次，所以viewID会重复，这样系统就没办法帮你管理状态了。所以如果你要管理children的状态，就必须亲自动手了，而不是让children自己管理自己的状态。</em></p>
<p>要想管理children的状态，你必须要知道ViewGroup的四个状态管理的方法，他们是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dispatchSaveInstanceState</div><div class="line">dispatchFreezeSelfOnly</div><div class="line">dispatchRestoreInstanceState</div><div class="line">dispatchThawSelfOnly</div></pre></td></tr></table></figure>

<blockquote>
<p>A ViewGroup uses dispatchSaveInstanceState to first save its own state by calling super (view’s) dispatchSaveInstanceState, which in turn triggers onSaveInstanceState on itself and then calls the dispatchSaveInstanceState for each of its children. If the children are plain views and not ViewGroups, this will result in having their onSaveInstanceState called. Listing 2-12 presents the pseudo code for how these key methods are meshed together.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">ViewGroup.dispatchSaveInstanceState() {</div><div class="line">          View.dispatchSaveInstanceState()</div><div class="line">              ...ends up calling its own ViewGroup.onSaveInstanceState()</div><div class="line">          Children.dispatchSaveInstanceState()</div><div class="line">          ...ends up calling children's onSaveInstanceState()</div><div class="line">}</div><div class="line"></div><div class="line">View.dispatchSaveInstanceState() {</div><div class="line">        onSaveInstanceState()</div><div class="line">}</div><div class="line"></div><div class="line">ViewGroup.dispatchFreezeSelfOnly() {</div><div class="line">        View.dispatchSaveInstanceState()</div><div class="line">             ...ends up calling ViewGroup.onSaveInstanceState()</div><div class="line">}</div></pre></td></tr></table></figure>



<p>技巧在于<code>dispatchFreezeSelfOnly</code>,这个ViewGroup方法只是简单的保存了ViewGroup的状态，这同样也发生在对应的恢复<code>dispatchThawSelfOnly</code>上。所以你可以重写ViewGroup的方法来阻止children自己管理状态。如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span>(SparseArray&lt;Parcelable&gt; container)</div><div class="line">{</div><div class="line">  <span class="comment">//Don't call this so that children won't be explicitly saved</span></div><div class="line">  <span class="comment">//super.dispatchSaveInstanceState(container);</span></div><div class="line">  <span class="comment">//Call your self onsavedinstancestate</span></div><div class="line">  <span class="keyword">super</span>.dispatchFreezeSelfOnly(container);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchRestoreInstanceState</span>(</div><div class="line">   SparseArray&lt;Parcelable&gt; container)</div><div class="line">{</div><div class="line">  <span class="comment">//Don't call this so that children won't be explicitly saved</span></div><div class="line">  <span class="comment">//super.dispatchRestoreInstanceState(container);</span></div><div class="line">  <span class="keyword">super</span>.dispatchThawSelfOnly(container);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>接下来就需要ViewGroup在<code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code>中管理children的状态了，实例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span>(SparseArray&lt;Parcelable&gt; container) {</div><div class="line">	<span class="comment">// Don't call this so that children won't be explicitly saved</span></div><div class="line">	<span class="comment">// super.dispatchSaveInstanceState(container);</span></div><div class="line">	<span class="comment">// Call your self onsavedinstancestate</span></div><div class="line">	<span class="keyword">super</span>.dispatchFreezeSelfOnly(container);</div><div class="line">	Log.d(tag, <span class="string">"in dispatchSaveInstanceState"</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchRestoreInstanceState</span>(</div><div class="line">		SparseArray&lt;Parcelable&gt; container) {</div><div class="line">	<span class="comment">// Don't call this so that children won't be explicitly saved</span></div><div class="line">	<span class="comment">// .super.dispatchRestoreInstanceState(container);</span></div><div class="line">	<span class="keyword">super</span>.dispatchThawSelfOnly(container);</div><div class="line">	Log.d(tag, <span class="string">"in dispatchRestoreInstanceState"</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span>(Parcelable state) {</div><div class="line">	Log.d(tag, <span class="string">"in onRestoreInstanceState"</span>);</div><div class="line">	<span class="keyword">if</span> (!(state <span class="keyword">instanceof</span> SavedState)) {</div><div class="line">		<span class="keyword">super</span>.onRestoreInstanceState(state);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">// it is our state</span></div><div class="line">	SavedState ss = (SavedState) state;</div><div class="line">	<span class="comment">// Peel it and give the child to the super class</span></div><div class="line">	<span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</div><div class="line">	<span class="comment">// this.fromDate = ss.fromDate;</span></div><div class="line">	<span class="comment">// this.toDate= ss.toDate;</span></div><div class="line">	<span class="keyword">this</span>.setFromDate(ss.fromDate);</div><div class="line">	<span class="keyword">this</span>.setToDate(ss.toDate);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> Parcelable <span class="title">onSaveInstanceState</span>() {</div><div class="line">	Log.d(tag, <span class="string">"in onSaveInstanceState"</span>);</div><div class="line">	Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	SavedState ss = <span class="keyword">new</span> SavedState(superState);</div><div class="line">	ss.fromDate = <span class="keyword">this</span>.fromDate;</div><div class="line">	ss.toDate = <span class="keyword">this</span>.toDate;</div><div class="line">	<span class="keyword">return</span> ss;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Saved State inner static class</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedState</span> <span class="keyword">extends</span> <span class="title">BaseSavedState</span> </span>{</div><div class="line">	<span class="comment">// null values are allowed</span></div><div class="line">	<span class="keyword">private</span> Calendar fromDate;</div><div class="line">	<span class="keyword">private</span> Calendar toDate;</div><div class="line"></div><div class="line">	SavedState(Parcelable superState) {</div><div class="line">		<span class="keyword">super</span>(superState);</div><div class="line">	}</div><div class="line"></div><div class="line">	SavedState(Parcelable superState, Calendar inFromDate, Calendar inToDate) {</div><div class="line">		<span class="keyword">super</span>(superState);</div><div class="line">		fromDate = inFromDate;</div><div class="line">		toDate = inToDate;</div><div class="line">	}</div><div class="line">	<span class="annotation">@Override</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span>(Parcel out, <span class="keyword">int</span> flags) {</div><div class="line">		<span class="keyword">super</span>.writeToParcel(out, flags);</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (fromDate != <span class="keyword">null</span>) {</div><div class="line">			out.writeLong(fromDate.getTimeInMillis());</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			out.writeLong(-<span class="number">1</span>L);</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (fromDate != <span class="keyword">null</span>) {</div><div class="line">			out.writeLong(toDate.getTimeInMillis());</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			out.writeLong(-<span class="number">1</span>L);</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="annotation">@Override</span></div><div class="line">	<span class="keyword">public</span> String <span class="title">toString</span>() {</div><div class="line">		StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">"fromDate:"</span></div><div class="line">				+ DurationControl.getDateString(fromDate));</div><div class="line">		sb.append(<span class="string">"fromDate:"</span> + DurationControl.getDateString(toDate));</div><div class="line">		<span class="keyword">return</span> sb.toString();</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="annotation">@SuppressWarnings</span>(<span class="string">"hiding"</span>)</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;SavedState&gt; CREATOR </div><div class="line">	   = <span class="keyword">new</span> Parcelable.Creator&lt;SavedState&gt;() {</div><div class="line">		<span class="keyword">public</span> SavedState <span class="title">createFromParcel</span>(Parcel in) {</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> SavedState(in);</div><div class="line">		}</div><div class="line"></div><div class="line">		<span class="keyword">public</span> SavedState[] <span class="title">newArray</span>(<span class="keyword">int</span> size) {</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> SavedState[size];</div><div class="line">		}</div><div class="line">	};</div><div class="line"></div><div class="line">	<span class="comment">// Read back the values</span></div><div class="line">	<span class="keyword">private</span> <span class="title">SavedState</span>(Parcel in) {</div><div class="line">		<span class="keyword">super</span>(in);</div><div class="line"></div><div class="line">		<span class="comment">// Read the from date</span></div><div class="line">		<span class="keyword">long</span> lFromDate = in.readLong();</div><div class="line">		<span class="keyword">if</span> (lFromDate == -<span class="number">1</span>) {</div><div class="line">			fromDate = <span class="keyword">null</span>;</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			fromDate = Calendar.getInstance();</div><div class="line">			fromDate.setTimeInMillis(lFromDate);</div><div class="line">		}</div><div class="line">		<span class="comment">// Read the from date</span></div><div class="line">		<span class="keyword">long</span> lToDate = in.readLong();</div><div class="line">		<span class="keyword">if</span> (lFromDate == -<span class="number">1</span>) {</div><div class="line">			toDate = <span class="keyword">null</span>;</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			toDate = Calendar.getInstance();</div><div class="line">			toDate.setTimeInMillis(lToDate);</div><div class="line">		}</div><div class="line">	}</div><div class="line">}<span class="comment">// eof-state-class</span></div></pre></td></tr></table></figure>

<p><em>其实这就相当于把整个组合控件当成一个View来管理</em></p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-android-custom-view" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/28/android-custom-view/" class="article-date">
  	<time datetime="2014-11-28T08:35:39.000Z" itemprop="datePublished">Nov 28 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/customView/">customView</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/28/android-custom-view/">android 自定义View</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概览：">概览：</h3>
<ol>
<li>View 的生命周期</li>
<li>Traversals</li>
<li>Measure</li>
<li>Draw</li>
<li>Custom Attributes</li>
<li>监听事件很简单，不讲了</li>
<li>状态保存</li>
<li>参考链接</li>
</ol>
<h3 id="1-_View_的生命周期">1. View 的生命周期</h3>
<ul>
<li>Attachment/detachment（一般不用care）</li>
<li>Traversals（必须care）</li>
<li>State save/restore（看你的需求了）</li>
</ul>
<p>Attachment的回调接口是<code>onAttachedToWindow()</code>，在这里你可以做以下操作</p>
<ul>
<li>Call super.onAttachedToWindow()!</li>
<li>Perform any relevant state resets</li>
<li>Start listening for state changes</li>
</ul>
<p>detachment的回调接口是<code>onDetachedFromWindow()</code>，在这里你可以做以下操作</p>
<ul>
<li>Call super.onDetachedFromWindow()!</li>
<li>Remove any posted Runnables</li>
<li>Stop listening for data changes</li>
<li>Clean up resources <ul>
<li>Bitmaps</li>
<li>Threads</li>
</ul>
</li>
</ul>
<p>看看官方的<code>SwipeRefreshLayout</code>的运用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span>() {</div><div class="line">    <span class="keyword">super</span>.onAttachedToWindow();</div><div class="line">    removeCallbacks(mCancel);</div><div class="line">    removeCallbacks(mReturnToStartPosition);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span>() {</div><div class="line">    <span class="keyword">super</span>.onDetachedFromWindow();</div><div class="line">    removeCallbacks(mReturnToStartPosition);</div><div class="line">    removeCallbacks(mCancel);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>打个简单地比喻就是，如果你的View和网络操作相关的话，最好在这里做取消操作。它这里的操作其实就是取消或重置动画。好了，这里就不多说了，一般用不到。下面说说遍历Traversals。</p>
<h3 id="2-_Traversals">2. Traversals</h3>
<p>Traversals 分四个阶段</p>
<p><strong>Animate—&gt;Measure—&gt;Layout—&gt;Draw</strong></p>
<p>我们现在关心的是Measure和Draw，分别对应<code>onMeasure()</code>,<code>onDraw()</code>,先看看View的默认实现吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) {</div><div class="line">    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</div><div class="line">            getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getDefaultSize</span>(<span class="keyword">int</span> size, <span class="keyword">int</span> measureSpec) {</div><div class="line">    <span class="keyword">int</span> result = size;</div><div class="line">    <span class="keyword">int</span> specMode = MeasureSpec.getMode(measureSpec);</div><div class="line">    <span class="keyword">int</span> specSize = MeasureSpec.getSize(measureSpec);</div><div class="line"></div><div class="line">    <span class="keyword">switch</span> (specMode) {</div><div class="line">    <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</div><div class="line">        result = size;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MeasureSpec.AT_MOST:</div><div class="line">    <span class="keyword">case</span> MeasureSpec.EXACTLY:</div><div class="line">        result = specSize;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">}    </div><div class="line">    </div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span>(Canvas canvas) {</div><div class="line">}</div></pre></td></tr></table></figure>

<p>现在来看看具体的Measure</p>
<h3 id="3-_Measure">3. Measure</h3>
<p>如果你自定义的View没有特殊尺寸要求的话，也可以不重写<code>onMeasure()</code>。现在来说说比较难理解的MeasureSpec 模式，三张图搞定它</p>
<p><img src="http://ww3.sinaimg.cn/mw690/72589a09gw1emqt5tk0q6j20xf0gmq4u.jpg" alt="MeasureSpec.EXACTLY"></p>
<p><img src="http://ww1.sinaimg.cn/mw690/72589a09gw1emqt5ue98bj20xp0gkwg0.jpg" alt="MeasureSpec.AT_MOST"></p>
<p><img src="http://ww4.sinaimg.cn/mw690/72589a09gw1emqt5u7ni2j20z00gp404.jpg" alt="MeasureSpec.UNSPECIFIED"></p>
<p>在<code>onMeasure()</code>里由于没有回调，框架依赖你最后设置尺寸，所以你一定要调用<code>setMeasuredDimension()</code>,否则运行时会crash。</p>
<p>看看大牛Dave Smith 给的一个模板吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span>(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec) {</div><div class="line">    <span class="comment">//Get the width measurement</span></div><div class="line">    <span class="keyword">int</span> widthSize = MeasureUtils.getMeasurement(widthMeasureSpec, getDesiredWidth());</div><div class="line"></div><div class="line">    <span class="comment">//Get the height measurement</span></div><div class="line">    <span class="keyword">int</span> heightSize = MeasureUtils.getMeasurement(heightMeasureSpec, getDesiredHeight());</div><div class="line"></div><div class="line">    <span class="comment">//MUST call this to store the measurements</span></div><div class="line">    setMeasuredDimension(widthSize, heightSize);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>工具方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MeasureUtils</span> </span>{</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * Utility to return a view's standard measurement. Uses the</div><div class="line">     * supplied size when constraints are given. Attempts to</div><div class="line">     * hold to the desired size unless it conflicts with provided</div><div class="line">     * constraints.</div><div class="line">     *</div><div class="line">     *<span class="javadoctag"> @param</span> measureSpec Constraints imposed by the parent</div><div class="line">     *<span class="javadoctag"> @param</span> contentSize Desired size for the view</div><div class="line">     *<span class="javadoctag"> @return</span> The size the view should be.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMeasurement</span>(<span class="keyword">int</span> measureSpec, <span class="keyword">int</span> contentSize) {</div><div class="line">        <span class="keyword">int</span> specMode = View.MeasureSpec.getMode(measureSpec);</div><div class="line">        <span class="keyword">int</span> specSize = View.MeasureSpec.getSize(measureSpec);</div><div class="line">        <span class="keyword">int</span> resultSize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (specMode) {</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.UNSPECIFIED:</div><div class="line">                <span class="comment">//Big as we want to be</span></div><div class="line">                resultSize = contentSize;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.AT_MOST:</div><div class="line">                <span class="comment">//Big as we want to be, up to the spec</span></div><div class="line">                resultSize = Math.min(contentSize, specSize);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> View.MeasureSpec.EXACTLY:</div><div class="line">                <span class="comment">//Must be the spec size</span></div><div class="line">                resultSize = specSize;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> resultSize;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="4-_Draw">4. Draw</h3>
<p>这其实没有太多要说的，<code>onDraw()</code>回调已经给你了一个Canvas，你要做的就是画各种你需要的东西了。看看Canvas的官方定义吧：</p>
<blockquote>
<p>The Canvas class holds the “draw” calls. To draw something, you need 4 basic components: A Bitmap to hold the pixels, a Canvas to host the draw calls (writing into the bitmap), a drawing primitive (e.g. Rect, Path, text, Bitmap), and a paint (to describe the colors and styles for the drawing).</p>
</blockquote>
<p>这里的Canvas已经包含一个mutable 的Bitmap了。需要注意的是<code>onDraw()</code>调用的很频繁，实例化对象的操作应该都放到外面。随便看个例子吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span>(Canvas canvas) {</div><div class="line">    <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">    Log.d(tag,<span class="string">"onDraw called"</span>);</div><div class="line">    <span class="keyword">int</span> w = <span class="keyword">this</span>.getWidth();</div><div class="line">    <span class="keyword">int</span> h = <span class="keyword">this</span>.getHeight();</div><div class="line">    <span class="keyword">int</span> t = <span class="keyword">this</span>.getTop();</div><div class="line">    <span class="keyword">int</span> l = <span class="keyword">this</span>.getLeft();</div><div class="line">    <span class="keyword">int</span> ox = w/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> oy = h/<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> rad = Math.min(ox,oy)/<span class="number">2</span>;</div><div class="line">    canvas.drawCircle(ox, oy, rad, getBrush());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>其实这里的获取宽高的操作应该放到<code>onSizeChanged()</code>里面，这个是在<code>onLayout()</code>里调用的，而且一般只遍历一次。</p>
<h3 id="5-_Custom_Attributes">5. Custom Attributes</h3>
<p>这个没什么要讲的，看例子就理解了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Listing 1-18. Defining Custom Attributes in attrs.xml</div><div class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"CircleView"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"strokeWidth"</span> <span class="attribute">format</span>=<span class="value">"integer"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"strokeColor"</span> <span class="attribute">format</span>=<span class="value">"color|reference"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></div></pre></td></tr></table></figure>

<p>下面这段好好理解<br>Given the attrs.xml in Listing 1-18, Android generates the following IDs:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">R.attr.strokeWidth (<span class="keyword">int</span>)</div><div class="line">R.attr.srokeColor (<span class="keyword">int</span>)</div><div class="line">R.styleable.CircelView (an array of ints)</div><div class="line">R.styleable.CircleView_strokeWidth (offset into the array)</div><div class="line">R.styleable.CircelView_strokeColor (offset into the array)</div></pre></td></tr></table></figure>

<p>在初始化时</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="title">CircleView</span>(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle) {</div><div class="line">    <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">    <span class="comment">//Use the array constant to read the bag once</span></div><div class="line">    TypedArray t = context.obtainStyledAttributes(attrs,</div><div class="line">                     R.styleable.CircleView,</div><div class="line">                     defStyle, <span class="comment">//if any values are in the theme</span></div><div class="line">                     <span class="number">0</span>); <span class="comment">//Do you have your own style group</span></div><div class="line">    <span class="comment">//Use the offset in the bag to get your value</span></div><div class="line">    strokeColor = t.getColor(R.styleable.CircleView_strokeColor, mDefaultStrokeColor);</div><div class="line">    strokeWidth = t.getInt(R.styleable.CircleView_strokeWidth, mDefaultStrokeWidth);</div><div class="line">    <span class="comment">//Recycle the typed array</span></div><div class="line">    t.recycle();</div><div class="line">    <span class="comment">//Go ahead and initialize your class.</span></div><div class="line">    initCircleView();</div><div class="line">}</div></pre></td></tr></table></figure>

<blockquote>
<p>DON’T FORGET: TypedArrays are heavyweight objects that should be recycled immediately after all the attributes you need have been extracted.</p>
</blockquote>
<h3 id="6-_监听事件很简单，不讲了">6. 监听事件很简单，不讲了</h3>
<h3 id="7-_状态保存">7. 状态保存</h3>
<p>用系统的方式保存状态，万无一失，下面看模板:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Save and restore work</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span>(Parcelable p)</div><div class="line">{</div><div class="line">	<span class="keyword">this</span>.onRestoreInstanceStateStandard(p);</div><div class="line">	<span class="keyword">this</span>.initCircleView();</div><div class="line">}</div><div class="line"><span class="annotation">@Override</span></div><div class="line"><span class="keyword">protected</span> Parcelable <span class="title">onSaveInstanceState</span>()</div><div class="line">{</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.onSaveInstanceStateStandard();</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Use a simpler approach</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceStateSimple</span>(Parcelable p)</div><div class="line">{</div><div class="line">	<span class="keyword">if</span> (!(p <span class="keyword">instanceof</span> Bundle))</div><div class="line">	{</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"unexpected bundle"</span>);</div><div class="line">	}</div><div class="line">	Bundle b = (Bundle)p;</div><div class="line">	defRadius = b.getInt(<span class="string">"defRadius"</span>);</div><div class="line">	Parcelable sp = b.getParcelable(<span class="string">"super"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//No need to call parent. It is just a base view</span></div><div class="line">	<span class="keyword">super</span>.onRestoreInstanceState(sp);</div><div class="line">}</div><div class="line"><span class="keyword">private</span> Parcelable <span class="title">onSaveInstanceStateSimple</span>()</div><div class="line">{</div><div class="line">	<span class="comment">//Don't call the base class as it will return a null</span></div><div class="line">	Parcelable p = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	Bundle b = <span class="keyword">new</span> Bundle();</div><div class="line">	b.putInt(<span class="string">"defRadius"</span>,defRadius);</div><div class="line">	b.putParcelable(<span class="string">"super"</span>,p);</div><div class="line">	<span class="keyword">return</span> b;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Use a standard approach</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceStateStandard</span>(Parcelable state)</div><div class="line">{</div><div class="line">	<span class="comment">//If it is not yours doesn't mean it is BaseSavedState</span></div><div class="line">	<span class="comment">//You may have a parent in your hierarchy that has their own </span></div><div class="line">	<span class="comment">//state derived from BaseSavedState</span></div><div class="line">	<span class="comment">//It is like peeling an onion or a Russian doll</span></div><div class="line">	<span class="keyword">if</span> (!(state <span class="keyword">instanceof</span> SavedState)) {</div><div class="line">        <span class="keyword">super</span>.onRestoreInstanceState(state);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    }    </div><div class="line">	<span class="comment">//it is our state</span></div><div class="line">	SavedState ss = (SavedState)state;</div><div class="line">	<span class="comment">//Peel it and give the child to the super class</span></div><div class="line">    <span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</div><div class="line">    </div><div class="line">    defRadius = ss.defRadius;</div><div class="line">}</div><div class="line"><span class="keyword">private</span> Parcelable <span class="title">onSaveInstanceStateStandard</span>()</div><div class="line">{</div><div class="line">	Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">	SavedState ss = <span class="keyword">new</span> SavedState(superState);</div><div class="line">	ss.defRadius = <span class="keyword">this</span>.defRadius;</div><div class="line">	<span class="keyword">return</span> ss;    	</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line"> * ***************************************************************</div><div class="line"> * Saved State inner static class</div><div class="line"> * ***************************************************************</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedState</span> <span class="keyword">extends</span> <span class="title">BaseSavedState</span> </span>{</div><div class="line">    <span class="keyword">int</span> defRadius;</div><div class="line"></div><div class="line">    SavedState(Parcelable superState) {</div><div class="line">        <span class="keyword">super</span>(superState);</div><div class="line">    }</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span>(Parcel out, <span class="keyword">int</span> flags) {</div><div class="line">        <span class="keyword">super</span>.writeToParcel(out, flags);</div><div class="line">        out.writeInt(defRadius);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//Read back the values</span></div><div class="line">    <span class="keyword">private</span> <span class="title">SavedState</span>(Parcel in) {</div><div class="line">        <span class="keyword">super</span>(in);</div><div class="line">        defRadius = in.readInt();</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> String <span class="title">toString</span>() {</div><div class="line">    	<span class="keyword">return</span> <span class="string">"CircleView defRadius:"</span> + defRadius;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"hiding"</span>)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;SavedState&gt; CREATOR</div><div class="line">            = <span class="keyword">new</span> Parcelable.Creator&lt;SavedState&gt;() {</div><div class="line">        <span class="keyword">public</span> SavedState <span class="title">createFromParcel</span>(Parcel in) {</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SavedState(in);</div><div class="line">        }</div><div class="line">        <span class="keyword">public</span> SavedState[] <span class="title">newArray</span>(<span class="keyword">int</span> size) {</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SavedState[size];</div><div class="line">        }</div><div class="line">    };</div><div class="line"></div><div class="line">}<span class="comment">//eof-state-class</span></div></pre></td></tr></table></figure>

<p>注意：你需要在初始化时，调用<code>this.setSaveEnabled(true);</code>,当然，状态保存也不是必须的，看你的需求了。</p>
<h3 id="8-_参考链接">8. 参考链接</h3>
<p><a href="https://www.youtube.com/watch?v=NYtB6mlu7vA" target="_blank" rel="external">https://www.youtube.com/watch?v=NYtB6mlu7vA</a><br><a href="https://thenewcircle.com/s/post/1663/tutorial_enhancing_android_ui_with_custom_views_dave_smith_video" target="_blank" rel="external">https://thenewcircle.com/s/post/1663/tutorial_enhancing_android_ui_with_custom_views_dave_smith_video</a><br><a href="https://dl.dropboxusercontent.com/u/16714463/Google%20IO%202014/Material%20Witness.pdf" target="_blank" rel="external">https://dl.dropboxusercontent.com/u/16714463/Google%20IO%202014/Material%20Witness.pdf</a><br><a href="http://developer.android.com/training/custom-views/index.html" target="_blank" rel="external">http://developer.android.com/training/custom-views/index.html</a><br><a href="http://developer.android.com/guide/topics/ui/custom-components.html" target="_blank" rel="external">http://developer.android.com/guide/topics/ui/custom-components.html</a></p>
<p>《Expert Android》</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  

      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Reacoder
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>